<!doctype html>
<html lang="en">
<head>
    <title>{{ sailor_name }}'s RÃ©sumÃ©</title>
</head>
<body>
    <h1>{{ sailor_name }}'s RÃ©sumÃ©</h1>
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>Class</th>
                <th>Regatta</th>
                <th>Date</th>
                <th>Place</th>
                <th>Position</th>
            </tr>
        </thead>
        <tbody>
            {% for row in tables %}
            <tr>
                <td>{{ row.Source }}</td>
                <td>{{ row.Regatta }}</td>
                <td>{{ row.Date }}</td>
                <td>{{ row.Place }}</td>
                <td>{{ row.Result }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <br>
    <a href="/download">ðŸ“„ Download RÃ©sumÃ© as PDF</a>
</body>
</html>
>

<!DOCTYPE html>
<html lang="en">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="https://js.stripe.com/v3/"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="/public/assets/js/jquery-ui.min.js"></script>
    <link href="/public/assets/css/jquery-ui.min.css" rel="stylesheet">
    <script type="text/javascript" src="/parse-sdk-js"></script>
    <script type="text/javascript" src="/sc-common"></script>
    <!-- start vue -->
    
        <!-- prod minified vue js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>
    
    <script src="/public/assets/js/catch-all-minified/vue.min.js"></script>
    <!-- end vue -->
    <!-- library for image orientation -->
    <script src="/public/assets/js/load-image-all.min.js"></script>
    <!-- moment.js -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.45/moment-timezone-with-data.min.js"></script>
    <!-- library for charts -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <link rel="stylesheet" href="/public/assets/css/material-icons.css">
    <!-- <link rel="stylesheet" href="https://kit.fontawesome.com/a59cae6e7b.css" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="/public/assets/css/font-awesome.css" crossorigin="anonymous">
    <!-- more js -->
    <script src="/public/assets/js/cookies.js"></script>
    

    
        <!-- main app -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:400,500|Cormorant+Garamond|Lato:300,400,700|Lora:400,500|Montserrat:400,500,600" rel="stylesheet">
        <link rel="stylesheet" href="/public/assets/css/stylesheet.css">
        <link rel="stylesheet" media="print" href="/public/assets/css/print.css">
        <script src="/public/assets/js/catch-all-minified/common.min.js"></script>
        <!-- Tip Tap browserified -->
        <script src="/public/assets/browserified/tiptap-browserified.js"></script>
        <!-- Juice browserified for inline css -->
        <script src="/public/assets/browserified/juice-browserified.js"></script>
        <!-- <script src="/public/assets/browserified/tiptaptest.js"></script> -->
        <!-- Swiper JS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    

    
        <link rel="shortcut icon" href="/public/assets/images/favicons/favicon.ico">
        <link rel="icon" sizes="16x16 32x32 64x64" href="/public/assets/images/favicons/favicon.ico">
        <link rel="apple-touch-icon" href="/public/assets/images/favicons/apple-touch-icon.png">
        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-TileImage" content="/public/assets/images/favicons/favicon.ico">
    

    <link rel="stylesheet" href="/public/assets/css/ios.css">

    <!-- weglot translations -->
    

    

    

    
    
    <!-- userway.org accessibility snippet -->
    

    

    
        <script src="/public/assets/js/catch-all-minified/micro-site-regatta-common.min.js"></script>
        <script src="/public/assets/js/catch-all-minified/micro-site-regatta-results.min.js"></script>
    

    

    
    
        <title>2025 Santa Barbara Spring Dinghy Regatta (Ullman-Frost and Hamlin #4)</title>
    
    <!-- fb open graph tags -->
    <meta property="fb:app_id" content="314788812688609" />
    
        <meta property="og:image" content="https://d282wvk2qi4wzk.cloudfront.net/O9XRnUaJhZ_regattaLogo_1649724983198">
    
    
        <meta property="og:description" content= "2025 Santa Barbara Spring Dinghy Regatta (Ullman-Frost and Hamlin #4) results">
        <meta name="description" content="2025 Santa Barbara Spring Dinghy Regatta (Ullman-Frost and Hamlin #4) results">
    

    <!-- Google Analytics for clubs -->
     
    <!-- END google analytics for clubs -->

    <!-- FB pixel for clubs -->
     
    <!-- FB pixel for clubs -->

    

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11296499174"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'AW-11296499174');
        </script>

        <!-- Facebook Pixel Code -->
        <script>
          !function(f,b,e,v,n,t,s)
          {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
          n.callMethod.apply(n,arguments):n.queue.push(arguments)};
          if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
          n.queue=[];t=b.createElement(e);t.async=!0;
          t.src=v;s=b.getElementsByTagName(e)[0];
          s.parentNode.insertBefore(t,s)}(window, document,'script',
          'https://connect.facebook.net/en_US/fbevents.js');
          fbq('init', '1793385660673912');
          fbq('track', 'PageView');
        </script>
        <noscript><img height="1" width="1" style="display:none"
          src="https://www.facebook.com/tr?id=1793385660673912&ev=PageView&noscript=1"
        /></noscript>
        <!-- End Facebook Pixel Code -->
        <!-- Calendly link widget begin -->
        <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
        <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript"></script>
        <!-- Calendly link widget end -->
    

    <!-- vue date picker -->
    <!-- see: https://vue3datepicker.com/ -->
    <script src="/public/assets/js/vue-date-picker-8.5.1.js"></script>
    <link rel="stylesheet" href="/public/assets/css/vue-date-picker.css">

</head>    <body 
        data-regatta="{&#34;startDate&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2025-05-17T04:00:00.000Z&#34;},&#34;endDate&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2025-05-18T04:00:00.000Z&#34;},&#34;lastChanceDate&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2025-05-17T06:59:00.000Z&#34;},&#34;keywords&#34;:[&#34;s&#34;,&#34;sb&#34;,&#34;sby&#34;,&#34;sbyc&#34;,&#34;b&#34;,&#34;ba&#34;,&#34;bar&#34;,&#34;barb&#34;,&#34;barba&#34;,&#34;barbar&#34;,&#34;barbara&#34;,&#34;sa&#34;,&#34;san&#34;,&#34;sant&#34;,&#34;santa&#34;,&#34;#&#34;,&#34;#4&#34;,&#34;#4)&#34;,&#34;h&#34;,&#34;ha&#34;,&#34;ham&#34;,&#34;haml&#34;,&#34;hamli&#34;,&#34;hamlin&#34;,&#34;(&#34;,&#34;(u&#34;,&#34;(ul&#34;,&#34;(ull&#34;,&#34;(ullm&#34;,&#34;(ullma&#34;,&#34;(ullman&#34;,&#34;(ullman-&#34;,&#34;(ullman-f&#34;,&#34;(ullman-fr&#34;,&#34;(ullman-fro&#34;,&#34;(ullman-fros&#34;,&#34;(ullman-frost&#34;,&#34;d&#34;,&#34;di&#34;,&#34;din&#34;,&#34;ding&#34;,&#34;dingh&#34;,&#34;dinghy&#34;,&#34;sp&#34;,&#34;spr&#34;,&#34;spri&#34;,&#34;sprin&#34;,&#34;spring&#34;,&#34;2&#34;,&#34;20&#34;,&#34;202&#34;,&#34;2025&#34;],&#34;clubObject&#34;:{&#34;payment_methods&#34;:[&#34;card&#34;,&#34;ach_debit&#34;],&#34;keywords&#34;:[&#34;s&#34;,&#34;sa&#34;,&#34;san&#34;,&#34;sant&#34;,&#34;santa&#34;,&#34;b&#34;,&#34;ba&#34;,&#34;bar&#34;,&#34;barb&#34;,&#34;barba&#34;,&#34;barbar&#34;,&#34;barbara&#34;,&#34;sb&#34;,&#34;sby&#34;,&#34;sbyc&#34;],&#34;name&#34;:&#34;Santa Barbara Yacht Club&#34;,&#34;subdomain&#34;:&#34;santabarbarayachtclub&#34;,&#34;currency&#34;:&#34;usd&#34;,&#34;location&#34;:&#34;Santa Barbara, CA&#34;,&#34;burgeeURL&#34;:&#34;https://d282wvk2qi4wzk.cloudfront.net/ajqIrcBJpJ_burgee_1631736209454&#34;,&#34;superAdmin&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;_User&#34;,&#34;objectId&#34;:&#34;Cir5a6o1EB&#34;},&#34;balance_transactions&#34;:&#34;none&#34;,&#34;advanced_reporting&#34;:true,&#34;createdAt&#34;:&#34;2021-09-15T20:03:32.098Z&#34;,&#34;updatedAt&#34;:&#34;2025-03-27T19:00:08.889Z&#34;,&#34;billing&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;billing&#34;,&#34;objectId&#34;:&#34;8tI9rJWf5X&#34;},&#34;membership_settings&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;club_membership_settings&#34;,&#34;objectId&#34;:&#34;5lgWNaaekx&#34;},&#34;web_settings&#34;:{&#34;user_verification_triggers&#34;:[&#34;membership_registration&#34;],&#34;public_account_creation&#34;:false,&#34;subdomain_activated&#34;:false,&#34;redirect_clubspot_to_subdomain&#34;:false,&#34;clubObject&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;clubs&#34;,&#34;objectId&#34;:&#34;YMi83ph4xh&#34;},&#34;createdAt&#34;:&#34;2021-09-15T20:03:37.162Z&#34;,&#34;updatedAt&#34;:&#34;2024-07-26T19:21:15.184Z&#34;,&#34;new_web_builder&#34;:true,&#34;ACL&#34;:{&#34;*&#34;:{&#34;read&#34;:true},&#34;role:club_web_YMi83ph4xh&#34;:{&#34;write&#34;:true}},&#34;objectId&#34;:&#34;0Pk6C1rdBl&#34;,&#34;__type&#34;:&#34;Object&#34;,&#34;className&#34;:&#34;club_web_settings&#34;},&#34;stripeAccountID&#34;:&#34;acct_1Ja4uD4caJ7gVOGQ&#34;,&#34;transit_account&#34;:true,&#34;ach_debit_v2&#34;:true,&#34;moved_to_ach_debit_v2&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2022-06-21T15:12:38.532Z&#34;},&#34;asset_clearing&#34;:true,&#34;support_admin&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;_User&#34;,&#34;objectId&#34;:&#34;ps5IEven5l&#34;},&#34;default_products&#34;:{&#34;donation&#34;:&#34;aF77W5b7sD&#34;,&#34;processing_passed_on&#34;:&#34;nFgjpHBWjV&#34;,&#34;invoice_late_fee&#34;:&#34;MQlo5R0QUL&#34;,&#34;membership_application_fees&#34;:&#34;WFZgssP6fs&#34;,&#34;membership_minimum&#34;:&#34;YgG4XRz8Zb&#34;,&#34;banquet_service_fee&#34;:&#34;JNGFtppXo6&#34;,&#34;banquet_prepayment&#34;:&#34;7ITNbSRyoU&#34;,&#34;banquet_deposit&#34;:&#34;QMVTglZmF4&#34;,&#34;surcharge&#34;:&#34;zECpuElcl4&#34;},&#34;group_waivers&#34;:false,&#34;print_server_v3&#34;:true,&#34;accounting_v2&#34;:true,&#34;custom_pos_items&#34;:true,&#34;timezone&#34;:&#34;America/New_York&#34;,&#34;timezoneOffset&#34;:-4,&#34;city&#34;:&#34;Santa Barbara&#34;,&#34;country&#34;:&#34;US&#34;,&#34;state&#34;:&#34;CA&#34;,&#34;zip&#34;:&#34;93101&#34;,&#34;updated_address&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2024-12-30T16:05:26.604Z&#34;},&#34;last_created_regatta&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2025-03-13T15:30:38.541Z&#34;},&#34;restock_inventory&#34;:true,&#34;ACL&#34;:{&#34;*&#34;:{&#34;read&#34;:true},&#34;role:club_admin_YMi83ph4xh&#34;:{&#34;write&#34;:true}},&#34;objectId&#34;:&#34;YMi83ph4xh&#34;,&#34;__type&#34;:&#34;Object&#34;,&#34;className&#34;:&#34;clubs&#34;},&#34;name&#34;:&#34;2025 Santa Barbara Spring Dinghy Regatta (Ullman-Frost and Hamlin #4)&#34;,&#34;location&#34;:&#34;Santa Barbara, CA&#34;,&#34;note&#34;:&#34;&lt;p&gt;The Santa Barbara Yacht Club is pleased to present the Santa Barbara Spring Dinghy Regatta.&amp;nbsp; Invited classes include: C420, 29er, 505, I-14, ILCA Standard, ILCA Radial, ILCA 4, and any other fleet with five or more entries. More information and event documents may be found on the event website at &lt;a target=\&#34;_blank\&#34; rel=\&#34;noopener\&#34; href=\&#34;https://sbyc.org/spring-dinghy\&#34;&gt;https://sbyc.org/spring-dinghy&lt;/a&gt;. If you have further questions, please contact the Santa Barbara Yacht Club Race Office: racing@sbyc.org or (805) 965-8112.&lt;/p&gt;&#34;,&#34;description&#34;:&#34;&lt;p&gt;All Notices are at https://sbyc.org/skiff-festival&lt;/p&gt;&#34;,&#34;imageURL&#34;:&#34;https://d282wvk2qi4wzk.cloudfront.net/O9XRnUaJhZ_regattaLogo_1649724983198&#34;,&#34;imageCrop&#34;:&#34;contain&#34;,&#34;has_series_scoring&#34;:&#34;true&#34;,&#34;series_throwouts&#34;:&#34;entire_series&#34;,&#34;housing&#34;:false,&#34;housing_approval&#34;:&#34;entire_event&#34;,&#34;collect_parentGuardian&#34;:true,&#34;collect_dob&#34;:true,&#34;collect_parentGuardian_secondary&#34;:false,&#34;collect_sailNumber&#34;:true,&#34;collect_medicalDetails&#34;:true,&#34;waitlist_payments&#34;:&#34;deferred&#34;,&#34;waitlist_updates&#34;:&#34;automatic&#34;,&#34;superAdmin&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;_User&#34;,&#34;objectId&#34;:&#34;Cir5a6o1EB&#34;},&#34;archived&#34;:false,&#34;pending&#34;:false,&#34;public&#34;:true,&#34;cloned_from&#34;:{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;regattas&#34;,&#34;objectId&#34;:&#34;sU7J5ECzYp&#34;},&#34;createdAt&#34;:&#34;2025-03-13T15:30:38.541Z&#34;,&#34;updatedAt&#34;:&#34;2025-05-16T22:42:00.672Z&#34;,&#34;customFieldsArray&#34;:[],&#34;boatClassesArray&#34;:[{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;boatClasses&#34;,&#34;objectId&#34;:&#34;9X0w8sRPGG&#34;},{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;boatClasses&#34;,&#34;objectId&#34;:&#34;HdraDBY5nO&#34;},{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;boatClasses&#34;,&#34;objectId&#34;:&#34;iJESDwo8E4&#34;},{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;boatClasses&#34;,&#34;objectId&#34;:&#34;36k7vs2ORf&#34;},{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;boatClasses&#34;,&#34;objectId&#34;:&#34;6WnZzeMABj&#34;}],&#34;email&#34;:&#34;racing@sbyc.org&#34;,&#34;city&#34;:&#34;Santa Barbara&#34;,&#34;country&#34;:&#34;US&#34;,&#34;state&#34;:&#34;CA&#34;,&#34;street&#34;:&#34;130 Harbor Way&#34;,&#34;updated_address&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2025-03-13T15:31:36.780Z&#34;},&#34;zip&#34;:&#34;93109&#34;,&#34;registration_closed&#34;:false,&#34;membershipConnections&#34;:[{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;membershipConnections&#34;,&#34;objectId&#34;:&#34;0UkhTxaiut&#34;},{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;membershipConnections&#34;,&#34;objectId&#34;:&#34;lErfKnwvHg&#34;}],&#34;connectedClubs&#34;:[{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;clubs&#34;,&#34;objectId&#34;:&#34;WiAmVdxMup&#34;}],&#34;date_windows&#34;:[{&#34;__type&#34;:&#34;Pointer&#34;,&#34;className&#34;:&#34;date_windows&#34;,&#34;objectId&#34;:&#34;7SHUnvs0jb&#34;}],&#34;parent_guardian_required_after_DOB&#34;:{&#34;__type&#34;:&#34;Date&#34;,&#34;iso&#34;:&#34;2007-05-02T07:00:00.000Z&#34;},&#34;registrations&#34;:24,&#34;ACL&#34;:{&#34;*&#34;:{&#34;read&#34;:true},&#34;role:club_regattas_YMi83ph4xh&#34;:{&#34;write&#34;:true},&#34;Cir5a6o1EB&#34;:{&#34;write&#34;:true},&#34;role:regatta_Heo9Cee2no&#34;:{&#34;write&#34;:true}},&#34;objectId&#34;:&#34;Heo9Cee2no&#34;}"
        data-regatta-id="Heo9Cee2no"
        data-hide-overall-series-tab=""
        data-has-series-scoring="true"
    >

        
    <div class="globalMessageInsert flexNoWrap easeFast hideForPrinting">
        <div class="global-message-icon-loading">
            <div class="global-message-icon-spinner"></div>
        </div>
        <p>
            <i class="fa-solid fa-square-check global-message-icon-good"></i>
            <i class="fa-solid fa-square-xmark global-message-icon-bad"></i>
            <span></span>
        </p>
    </div>


        <div id="overlay_results-race-overlay" class="standardOverlay scrollable hugePaddingBottom">
    <div 
        class="standardOverlayCard centeredBlock eightyThenNinety relative" 
        style="max-width: 100%;
        min-width: 100%;
        left: 0px;
        right: 0px;
        top: 10px;
        margin: 0px;
        border-radius: 0px;
        overflow: hidden;
        border-radius: 5px;"
    >
        <div class="relative flexNoWrap">
          <div class="drilldownHeaderBackButton easeFast" style="margin-top:15px;" onclick="fadeOut('#overlay_results-race-overlay');"></div>
          <h3 class="raceNumberInsert pointer" style="padding-left:10px;padding-top:20px;" onclick="fadeOut('#overlay_results-race-overlay');"></h3>
          <div class="flexGrowOne"></div>
          <div>
            <button class="primaryButton outline easeFast hideOnMobile" onclick="copyResultsToClipboard()" style="margin-top:15px;margin-right: 10px;">
                <div class="buttonIcon"></div>
                <span>Copy</span>
            </button>
            <button class="primaryButton outline easeFast" onclick="printResults()" style="margin-top:15px;margin-right: 10px;">
              <div class="buttonIcon"></div>
              <span>Print</span>
            </button>
          </div>
        </div>
        <div class="standardCardBody scrollable noPadding fff">
            <table id="race-results-overlay" class="tableInsert hundop race-results-overlay">
                <tbody>
                    <tr class="tableHeaderRow">
                      <th></th>
                      <th>Sail Number</th>
                      <th>Boat Name</th>
                      <th>Boat Type</th>
                      <th>Skipper</th>
                      <th>Handicap</th>
                      <th class="hidden showIfIsPursuit">Start Time</th>
                      <th>Corrected Time</th>
                      <th>Delta</th>
                      <th>Elapsed Time</th>
                      <th>Finish Time</th>
                    </tr>
                    <!-- rows injected here -->
                </tbody>
            </table>
            <div class="cardBodySpinnerWrap relative">
                <div class="cardBodySpinner centeredBlock"></div>
            </div>
            <p class="noObjectsMSG withPadding hidden">No results found.</p>
            <div class="flexWrapLeftAlign borderTop smallPaddingTop smallPaddingBottom roboto overflowHidden">
                <!-- inject metadata here -->
            
          </div>
        </div>
        <div class="raceDetails"></div>
    </div>
</div>
        <div 
            id="v-content" 
            class="hidden"
        >
            <!-- start standard content -->
            <div 
                class="lightBorderBottom sticky-header"
            >
                <div
                    style="padding-left:22px;padding-right:22px;"
                >
                    
                        <div class="smallIcon burgee left fe noMarginLeft" style="background-image:url(https://d282wvk2qi4wzk.cloudfront.net/ajqIrcBJpJ_burgee_1631736209454)"></div>
                    
                    <div class="flexNoWrap align-items-center">
                        <div>
                            <h2 
                                class="drilldownHeader capitalize relative" 
                                style="padding-bottom: 4px;white-space: initial;"
                            >2025 Santa Barbara Spring Dinghy Regatta (Ullman-Frost and Hamlin #4)</h2>
                            <div class="flexWrapLeftAlign" style="padding-top:3px;">
                                <p 
                                    v-if="loading.results"
                                    class="card-header-subtext coming-soon" 
                                    style="padding-top: 2px"
                                >xxxxxxxxxx</p>
                                <p 
                                    v-else
                                    class="card-header-subtext" 
                                    style="padding-top: 2px"
                                >{{ nice_as_of_date }}</p>
                            </div>
                        </div>
                        <div class="flexGrowOne"></div>
                        <button 
                            class="card-header-button-v3 easeFast noMarginRight flexNoWrap align-items-center hideForPrinting" 
                            @click="view_more()"
                        >
                            <i class="fa-regular fa-grid"></i>
                            <span 
                                class="hideOnMobile"
                                style="padding-left:5px;"
                            >More</span>
                        </button>
                    </div>
                </div>
            
                <!-- scrollable tab bar -->    
                <div 
                    class="scrollable tinyMarginTop"
                    style="padding-left: 22px;"
                > 
                    <div class="flexNoWrap">
                        
                        <!-- class picker -->
                        <template v-if="! loading.boat_classes">
                            <!-- we have classes -->
                            <div 
                                class="card-header-button-v3 noWrap centeredText pointer relative"
                                v-if="boat_classes.length >= 1"
                            >
                                {{ selected_class_name }}
                                <i class="fa-light fa-chevron-down" style="padding-left: 3px;"></i>
                                <select 
                                    v-model="selected_class_id"
                                    @change="class_changed"
                                >   
                                    <option 
                                        v-for="boat_class in boat_classes"
                                        :value="boat_class.id"
                                    >{{ boat_class.get('name') }}</option>
                                </select>
                            </div>
                            <!-- we don't have classes -->
                            <button 
                                class="card-header-button-v3 noWrap centeredText unclickable"
                                v-else
                            >
                                No classes found <i class="fa-light fa-chevron-down" style="padding-left: 3px;"></i>
                            </button>
                        </template>

                        <!-- division picker -->
                        <template v-if="divisions.length >= 1">

                            <!-- single select mode -->
                            <template 
                                v-if="! allow_division_multi_select"
                            >
                                <div 
                                    class="card-header-button-v3 noWrap centeredText pointer relative"
                                >
                                    {{ selected_divisions_string }}
                                    <i class="fa-light fa-chevron-down" style="padding-left: 3px;"></i>
                                    <select 
                                        @change="update_selected_division()"
                                        v-model="single_select_division_id"
                                    >   
                                        <option
                                            value="all"
                                        >All divisions</option>
                                        <option 
                                            v-for="division in divisions"
                                            :value="division.id"
                                        >{{ division.get('name') }}</option>
                                    </select>
                                </div>
                            </template>

                            <!-- multi select mode -->
                            <div 
                                class="relative"
                                v-else
                            >
                                <!-- 2 or more selected -->
                                <div
                                    v-if="selected_division_ids.length > 1"
                                    class="flexNoWrap noWrap relative filter_tag pointer"
                                    style="justify-content: center; align-items: center;"
                                    ref="division_filter_button"
                                    @click="show_division_dropdown = !show_division_dropdown"
                                >
                                    Divisions ({{ selected_division_ids.length }})
                                    <div class="xIcon pointer" @click.stop="unset_selected_division_ids"></div>
                                </div>
                                <!-- 1 selected -->
                                <div
                                    v-else-if="selected_division_ids.length === 1"
                                    class="flexNoWrap noWrap relative filter_tag pointer"
                                    style="justify-content: center; align-items: center;"
                                    ref="division_filter_button"
                                    @click="show_division_dropdown = !show_division_dropdown"
                                >
                                    {{ selected_divisions_string }}
                                    <div class="xIcon pointer" @click.stop="unset_selected_division_ids"></div>
                                </div>
                                <!-- 0 selected -->
                                <template v-else>
                                    <div 
                                        class="card-header-button-v3 noWrap centeredText pointer relative"
                                        ref="division_filter_button"
                                        @click.stop="show_division_dropdown = ! show_division_dropdown"
                                    >
                                        {{ selected_divisions_string }}
                                        <i 
                                            v-if="!show_division_dropdown"
                                            class="fa-light fa-chevron-down" 
                                            style="padding-left: 3px;"
                                        ></i>
                                        <i 
                                            v-else
                                            class="fa-light fa-chevron-up" 
                                            style="padding-left: 3px;"
                                        ></i>
                                    </div>
                                </template>

                                <!-- popup -->
                                <teleport to="body">
                                    <div 
                                        class="cardHeaderButtonFilterDropdown cardHeaderButtonDropdown_filter boxShadowBottom moreBlur" 
                                        :class="{active: show_division_dropdown}"
                                        style="position:fixed;"
                                        ref="filterDropdown"
                                        @click.stop
                                    >
                                        <div class="flexGrowOne flexNoWrap">
                                            <div 
                                                id="filter_popup_right" 
                                                class="filter_popup_right flexGrowTwo scrollable"
                                            >
                                                <div 
                                                    v-for="division in divisions"
                                                    class="popup-filter-option flexNoWrap"
                                                    :class="{'active': selected_division_ids.indexOf( division.id ) >= 0}"
                                                    :key="division.id"
                                                    @click.stop="clicked_division_option( division )"
                                                >
                                                    <i 
                                                        v-if="selected_division_ids.indexOf( division.id ) >= 0"
                                                        class="fa-solid fa-square-check"
                                                    ></i>
                                                    <i v-else class="fa-light fa-square"></i>
                                                    <div class="flexGrowOne">
                                                        <p>{{ division.get('name') }}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>      
                                    </div>
                                </teleport>
                            </div>
                        </template>                    
                        <!-- series picker -->
                        <template v-if="subevents.length >= 1 && ! selected_race">
                            <!-- we have subevents -->
                            <div 
                                class="card-header-button-v3 noWrap centeredText pointer relative"
                            >
                                {{ selected_subevent_name }}
                                <i class="fa-light fa-chevron-down" style="padding-left: 3px;"></i>
                                <select 
                                    v-model="selected_subevent_id"
                                    @change="subevent_changed"
                                >   
                                    <option 
                                        v-if="!hide_overall_series_tab"
                                        value="all"
                                    >Overall series</option>
                                    <option 
                                        v-for="subevent in subevents"
                                        :value="subevent.id"
                                    >{{ subevent.get('name') }}</option>
                                </select>
                            </div>
                        </template>
                        <!-- handicap race picker -->
                        <template v-if="handicap_label && races.length >= 1">
                            <!-- we have classes -->
                            <div
                                class="card-header-button-v3 noWrap centeredText pointer relative"
                            >
                                {{ selected_race_name }}
                                <i class="fa-light fa-chevron-down" style="padding-left: 3px;"></i>
                                <select 
                                    v-model="selected_race"
                                    @change="race_changed"
                                >
                                    <option 
                                        :value= undefined
                                    >Cumulative results</option>
                                    <option 
                                        v-for="race in races"
                                        :value="race"
                                    >{{ race_name( race ) }}</option>
                                </select>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            <!-- results table -->
            <div 
                class="overflowVisibleForPrinting"
                :class="[{'scrollable': responsiveView, 'has-divisions': divisions.length >= 1}]"
            >
                <div 
                    class="noBorder noPadding overflowVisibleForPrinting"
                    :class="{'scrollable': responsiveView}"
                >
                    <div class="relative">
                        <!-- loading results -->
                        <div 
                            v-if="loading.results"
                            class="cardBodySpinnerWrap relative active"
                            style="min-height: calc(100vh - 390px);"
                        >
                            <div class="cardBodySpinner centeredBlock"></div>
                        </div>
                        <!-- not loading -->
                        <template v-else>

                            <!-- pdf or external link scoring -->
                            <template v-if="scoring_config && (scoring_config.method == 'pdf' || scoring_config.method == 'external_link' )">
                                
                                <!-- great, we have a link -->
                                <p 
                                    v-if="scoring_config.url"
                                    class="subtext withPadding marginTopBottom" 
                                    style="min-height: calc(100vh - 390px);"
                                >
                                    Click here to view <a :href="scoring_config.url">{{ selected_class.get('name') }} results</a>.
                                </p>

                                <!-- don't have a link -->
                                <div 
                                    v-else
                                    class="noObjectsMSG paddingLeftRightTwenty paddingTopBottomThirty" 
                                    style="min-height: calc(100vh - 390px);"
                                >
                                    <p class="noObjectsMSG">No scores posted.</p>
                                </div>

                            </template>
                            <!-- default scoring -->
                            <template v-else>
                                <!-- we have results! -->
                                <template v-if="scores_by_registration.length >= 1 && races.length >= 1">

                                    <div 
                                        id="table-container"
                                        ref="tableContainer"                         
                                    >
                                        <table
                                            v-if="selected_race && single_race_results"
                                            class="tableInsert fff hundop"
                                            ref="table"                                    
                                        >
                                            <thead>
                                                <tr class="tableHeaderRow">
                                                <th></th>
                                                <th>Sail Number</th>
                                                <th>Boat Name</th>
                                                <th>Boat Type</th>
                                                <th>Skipper</th>
                                                <th>Handicap</th>
                                                <th v-if="isPursuitRace">Start Time</th>
                                                <th>Corrected Time</th>
                                                <th>Delta</th>
                                                <th>Elapsed Time</th>
                                                <th>Finish Time</th>
                                                </tr>
                                                <!-- rows injected here -->
                                            </thead>
                                            <tbody>
                                                <tr 
                                                    v-for="(result,i) in single_race_results"
                                                    :key="result.registration.id"
                                                    class="tableRow"
                                                >
                                                    <!-- position -->
                                                    <td>
                                                        <p>{{ i + 1 }}</p>
                                                    </td>
                                                    <!-- sail number -->
                                                    <td>
                                                        <p v-if="result.registration.sailNumber">{{ result.registration.sailNumber }}</p>
                                                        <p v-else class="incomplete">None</p>
                                                    </td>
                                                    <!-- boat name -->
                                                    <td>
                                                        <p v-if="result.registration.boatName">{{ result.registration.boatName }}</p>
                                                        <p v-else class="incomplete">None</p>
                                                    </td>
                                                    <!-- boat type -->
                                                    <td>
                                                        <p v-if="result.registration.boatType">{{ result.registration.boatType }}</p>
                                                        <p v-else class="incomplete">None</p>
                                                    </td>
                                                    <!-- skipper -->
                                                    <td>
                                                        <p v-if="result.registration.lastName">{{ result.registration.lastName }}</p>
                                                        <p v-else class="incomplete">None</p>
                                                    </td>
                                                    <!-- handicap -->
                                                    <td>
                                                        <p v-if="result.registration.boatClassObject">{{ return_handicap(result.registration) }}</p>
                                                        <p v-else class="incomplete">None</p>
                                                    </td>
                                                    <!-- start time -->
                                                    <td v-if="isPursuitRace">
                                                        <p v-if="result.score.pursuitStart">{{ format_start_or_finish_time( result.score.pursuitStart, true ) }}</p>
                                                        <p v-else class="incomplete">None</p>
                                                    </td>                                                   
                                                    <!-- has letter score -->
                                                    <template v-if="result.score.letterScore && nonFinishingLetterScores.indexOf( result.score.letterScore ) >= 0">
                                                        <!-- corrected time -->
                                                        <td><p>{{result.score.letterScore + ' - ' + result.score.points}}</p></td>
                                                        <!-- delta -->
                                                        <td><p>{{result.score.letterScore + ' - ' + result.score.points}}</p></td>
                                                        <!-- elapsed time -->
                                                        <td><p>{{result.score.letterScore + ' - ' + result.score.points}}</p></td>
                                                        <!-- finish time -->
                                                        <td><p>{{result.score.letterScore + ' - ' + result.score.points}}</p></td>
                                                    </template>
                                                    <!-- non letter score -->
                                                    <template v-else>
                                                        <!-- corrected time -->
                                                        <td>
                                                            <p v-if="result.score.corrected_time">
                                                                {{ return_time_for_milliseconds(result.score.corrected_time)}}
                                                                <span v-if="result.score.letterScore">
                                                                    {{ ' - ' + result.score.letterScore }}
                                                                </span>
                                                            </p>
                                                            <p v-else class="incomplete">None</p>
                                                        </td>
                                                        <!-- delta time -->
                                                        <td>
                                                            <p v-if="result.score.corrected_time && i === 0">
                                                                {{ return_time_for_milliseconds(0) }}
                                                                <span v-if="result.score.letterScore">
                                                                    {{ ' - ' + result.score.letterScore }}
                                                                </span>
                                                            </p>
                                                            <p v-else-if="result.score.corrected_time">
                                                                {{ return_time_for_milliseconds(return_delta(result.score)) }}
                                                                <span v-if="result.score.letterScore">
                                                                    {{ ' - ' + result.score.letterScore }}
                                                                </span>
                                                            </p>                                                                                                                <p v-else class="incomplete">None</p>
                                                            <p v-else class="incomplete">None</p>
                                                        </td>
                                                        <!-- elapsed time -->
                                                        <td>
                                                            <p v-if="result.score.milliseconds_elapsed">
                                                                {{ return_time_for_milliseconds(result.score.milliseconds_elapsed) }}
                                                                <span v-if="result.score.letterScore">
                                                                    {{ ' - ' + result.score.letterScore }}
                                                                </span>
                                                            </p>
                                                            <p v-else-if="result.score.pursuitStart">
                                                                {{ return_time_for_milliseconds(return_pursuit_elapsed_time(result.score)) }}
                                                                <span v-if="result.score.letterScore">
                                                                    {{ ' - ' + result.score.letterScore }}
                                                                </span>
                                                            </p>
                                                            <p v-else class="incomplete">None</p>
                                                        </td>
                                                        <!-- finish time -->
                                                        <td>
                                                            <p v-if="result.score.finish_time">
                                                                {{ format_start_or_finish_time( result.score.finish_time, true ) }}
                                                                <span v-if="result.score.letterScore">
                                                                    {{ ' - ' + result.score.letterScore }}
                                                                </span>
                                                            </p>
                                                            <p v-else class="incomplete">None</p>
                                                        </td>
                                                    </template>
                                                </tr>
                                            </tbody>
                                        </table>                
                                        <div 
                                            v-else-if="selected_race"
                                            class="noObjectsMSG paddingLeftRightTwenty paddingTopBottomThirty" 
                                            style="min-height: calc(100vh - 390px);"
                                        >
                                            <p class="noObjectsMSG">No scores posted.</p>
                                        </div>
                                        <table
                                            v-else
                                            class="tableInsert fff hundop"
                                            ref="table"
                                        >
                                            <tbody>
                                                <tr class="tableHeaderRow">
                                                    <th style="padding-right:15px;padding-left:15px;"></th>
                                                    <th class="sticky-column">Sailors</th>
                                                    <th class="print_smallPadding">Sail Number</th>
                                                    <th 
                                                        v-if="scoring_config.method == 'one_design_with_fleets'"
                                                        class="print_smallPadding"
                                                    >Fleet</th>
                                                    <th 
                                                        v-if="result_fields.boatName"
                                                        class="print_smallPadding"
                                                    >Boat Name</th>
                                                    <th 
                                                        v-if="result_fields.clubOrg"
                                                        class="print_smallPadding"
                                                    >Club/Org</th>
                                                    <th 
                                                        v-if="result_fields.boatType"
                                                        class="print_smallPadding"
                                                    >Boat Type</th>
                                                    <th 
                                                        v-if="result_fields.boatColor"
                                                        class="print_smallPadding"
                                                    >Boat Color</th>
                                                    <th 
                                                        v-if="result_fields.spinnakerColor"
                                                        class="print_smallPadding"
                                                    >Spinnaker Color</th>
                                                    <th 
                                                        v-if="result_fields.loa"
                                                        class="print_smallPadding"
                                                    >LOA</th>
                                                    <th 
                                                        v-if="divisions.length >= 1"
                                                        class="print_smallPadding"
                                                    >Division</th>
                                                    <!-- laser masters -->
                                                    <template v-if="scoring_config.method == 'laserMaster'">
                                                        <th class="print_smallPadding lessPadding">Laser Master Rating</th>
                                                        <th class="print_smallPadding lessPadding">Master's Handicap</th>
                                                    </template>
                                                    <!-- all other handicap -->
                                                    <template v-else-if="handicap_label">
                                                        <th class="print_smallPadding lessPadding"
                                                        >{{ handicap_label }}</th>
                                                    </template>
                                                    <!-- score totals -->
                                                    <th class="centeredText print_smallPadding">Net</th>
                                                    <th class="centeredText print_smallPadding">Total</th>
                                                    <!-- race columns -->
                                                    <template 
                                                        v-for="race in races"
                                                    >                                                      
                                                        <th 
                                                            v-if="show_race_links"
                                                            class="centeredText print_smallPadding lessPadding"
                                                        ><a 
                                                            @click="tapped_view_race_specific_results( race )"
                                                        >{{ race_label( race ) }}</a></th>
                                                        <th 
                                                            v-else
                                                            class="centeredText print_smallPadding"
                                                        >{{ race_label( race ) }}</th>
                                                    </template>
                                                </tr>
                                                <!-- now the result rows -->
                                                <tr 
                                                    v-for="(result, i) in sorted_and_filtered_results"
                                                    :key="result.registrationObject.id"
                                                    class="resultsRow tableRow"
                                                >
                                                    <!-- position -->
                                                    <td class="first-cell"><p class="counter incomplete">{{ i + 1 }}</p></td>
                                                    <!-- sailor names -->
                                                    <td class="sticky-column">
                                                        <p class="preWrap minMaxOneThirty_print"><span v-html="sailor_names( result.registrationObject )"></span></p>
                                                    </td>
                                                    <!-- sail number -->
                                                    <td class="print_smallPadding"><span v-html="sail_number( result.registrationObject )"></span></td>
                                                    
                                                    <!-- fleet-->
                                                    <td 
                                                        v-if="scoring_config.method == 'one_design_with_fleets'"
                                                        class="print_smallPadding"
                                                    >
                                                        <p v-html="fleet_markup( result.registrationObject )"></p>
                                                    </td>

                                                    <!-- boat name -->
                                                    <td 
                                                        v-if="result_fields.boatName"
                                                        class="print_smallPadding"
                                                    >
                                                        <p 
                                                            v-if="result.registrationObject.boatName"
                                                            class="preWrap maxTwoHundo"
                                                        >{{ result.registrationObject.boatName }}</p>
                                                        <p 
                                                            v-else
                                                            class="incomplete"
                                                        >None</p>
                                                    </td>

                                                    <!-- club/org -->
                                                    <td 
                                                        v-if="result_fields.clubOrg"
                                                        class="print_smallPadding"
                                                    >
                                                        <p 
                                                            v-if="result.registrationObject.clubName"
                                                            class="preWrap maxTwoHundo"
                                                        >{{ result.registrationObject.clubName }}</p>
                                                        <p 
                                                            v-else
                                                            class="incomplete"
                                                        >None</p>
                                                    </td>

                                                    <!-- boat type -->
                                                    <td 
                                                        v-if="result_fields.boatType"
                                                        class="print_smallPadding"
                                                    >
                                                        <p 
                                                            v-if="result.registrationObject.boatType"
                                                            class="preWrap maxTwoHundo"
                                                        >{{ result.registrationObject.boatType }}</p>
                                                        <p 
                                                            v-else
                                                            class="incomplete"
                                                        >None</p>
                                                    </td>

                                                    <!-- boat color -->
                                                    <td 
                                                        v-if="result_fields.boatColor"
                                                        class="print_smallPadding"
                                                    >
                                                        <p 
                                                            v-if="result.registrationObject.boatColor"
                                                            class="preWrap maxTwoHundo"
                                                        >{{ result.registrationObject.boatColor }}</p>
                                                        <p 
                                                            v-else
                                                            class="incomplete"
                                                        >None</p>
                                                    </td>

                                                    <!-- spinnaker color -->
                                                    <td 
                                                        v-if="result_fields.spinnakerColor"
                                                        class="print_smallPadding"
                                                    >
                                                        <p 
                                                            v-if="result.registrationObject.spinnakerColor"
                                                            class="preWrap maxTwoHundo"
                                                        >{{ result.registrationObject.spinnakerColor }}</p>
                                                        <p 
                                                            v-else
                                                            class="incomplete"
                                                        >None</p>
                                                    </td>

                                                    <!-- loa -->
                                                    <td 
                                                        v-if="result_fields.loa"
                                                        class="print_smallPadding"
                                                    >
                                                        <p 
                                                            v-if="result.registrationObject.loa"
                                                            class="preWrap maxTwoHundo"
                                                        >{{ result.registrationObject.loa }}</p>
                                                        <p 
                                                            v-else
                                                            class="incomplete"
                                                        >None</p>
                                                    </td>

                                                    <!-- division-->
                                                    <td 
                                                        v-if="divisions.length >= 1"
                                                        class="print_smallPadding"
                                                    >
                                                        <span v-html="divisions_markup( result.registrationObject )"></span>
                                                    </td>

                                                    <!-- handicap -->
                                                    <td 
                                                        v-if="handicap_markup( result.registrationObject )"
                                                        class="print_smallPadding lessPadding"
                                                    >
                                                        <span v-html="handicap_markup( result.registrationObject )"></span>
                                                    </td>

                                                    <!-- laser master total -->
                                                    <td 
                                                        v-if="scoring_config.method == 'laserMaster'"
                                                        class="print_smallPadding lessPadding"
                                                    ><p class="centeredText">{{ return_master_total( result ) }}</p></td>

                                                    <!-- net -->
                                                    <td class="print_smallPadding">
                                                        <p class="centeredText">{{ result.net }}</p>
                                                    </td>

                                                    <!-- total -->
                                                    <td class="print_smallPadding">
                                                        <p class="centeredText">{{ return_total( result ) }}</p>
                                                    </td>

                                                    <!-- individual race scores -->
                                                    <template 
                                                        v-for="race in races"
                                                    >
                                                        <td 
                                                            class="centeredText print_smallPadding lessPadding"
                                                        ><span v-html="score_markup( race, result.scoring_data )"></span></td>
                                                    </template>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </template>
                                <!-- no results -->
                                <div 
                                    v-else
                                    class="noObjectsMSG paddingLeftRightTwenty paddingTopBottomThirty" 
                                    style="min-height: calc(100vh - 390px);"
                                >
                                    <p class="noObjectsMSG">No scores posted.</p>
                                </div>
                            </template>
                            <!-- race data for single race results -->
                            <template 
                                v-if="selected_race && single_race_start_details && single_race_start_details.length >= 1"
                                v-for="start_data in single_race_start_details"
                            >
                                <div class="race-metadata-wrap">

                                    <!-- Race and Start Number -->
                                    <div>
                                    <p class="inline-account-toolbar-header">
                                        Race {{ start_data.race_number }}, Start {{ start_data.number }}
                                    </p>
                                    </div>

                                    <!-- Conditions Section -->
                                    <div class="minTwoHundo marginTopBottom bigPaddingLeftRight textLeft">
                                    <h4 class="smallBlockLetters leftText smallMarginBottom">Conditions</h4>

                                    <!-- Start Time -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">Start time</p>
                                        <p class="flexGrowOne inline-value" v-if="start_data.start_time">
                                        {{ return_format_timespant_date(new Date(start_data.start_time)) }}
                                        </p>
                                        <p class="flexGrowOne inline-value incomplete" v-else>None</p>
                                    </div>

                                    <!-- Distance -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">Distance</p>
                                        <p class="flexGrowOne inline-value" v-if="start_data.distance">
                                        {{ start_data.distance }}nm
                                        </p>
                                        <p class="flexGrowOne inline-value incomplete" v-else>None</p>
                                    </div>

                                    <!-- Wind Speed -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">Wind speed (knots)</p>
                                        <p class="flexGrowOne inline-value" v-if="start_data.wind">
                                        {{ start_data.wind }} knots
                                        </p>
                                        <p class="flexGrowOne inline-value incomplete" v-else>None</p>
                                    </div>
                                    </div>

                                    <!-- Scoring Section -->
                                    <div class="minTwoHundo maxSixHundo marginTopBottom bigPaddingLeftRight textLeft">
                                    <h4 class="smallBlockLetters leftText smallMarginBottom">Scoring</h4>

                                    <!-- Rating System -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">Rating system</p>
                                        <p class="flexGrowOne inline-value" v-if="start_data.scoring.method">
                                        {{ return_string_for_scoring_method(start_data.scoring.method) }}
                                        </p>
                                        <p class="flexGrowOne inline-value incomplete" v-else>None</p>
                                    </div>

                                    <!-- Timing Method -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">Method (ToD vs. ToT)</p>
                                        <p class="flexGrowOne inline-value">
                                        {{ start_data.method === 'tod' ? 'Time over distance' : 'Time over time' }}
                                        </p>
                                    </div>

                                    <!-- PHRF A/B -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">PHRF A/B</p>
                                        <p class="flexGrowOne inline-value" v-if="start_data.scoring.method === 'phrf' || start_data.scoring.method === 'pursuit'">
                                        {{ start_data.phrf_a }} / {{ start_data.phrf_b }}
                                        </p>
                                        <p class="flexGrowOne inline-value incomplete" v-else>None</p>
                                    </div>

                                    <!-- ORC Course Option -->
                                    <div class="flexNoWrap tinyPaddingTop">
                                        <p class="inline-label">ORC course option</p>
                                        <p class="flexGrowOne inline-value" v-if="start_data.orc_course_option && start_data.orc_course_option !== 'Select option'">
                                        {{ nice_orc_course_option(start_data.orc_course_option) }}
                                        </p>
                                        <p class="flexGrowOne inline-value incomplete" v-else>None</p>
                                    </div>
                                    </div>
                                </div>
                            </template>
                        </template>
                    </div>
                </div>
                <div class="relative fff bigPaddingTop bigPaddingBottom hugePaddingBottomOnMobile">
                    <div class="powered_by_wrap">
                        <div class="flexNoWrapCenter align-items-center">
                            <p class="powered_by noMarginLeft">Powered by </p>
                            <h1 class="modern" style="font-weight:bold;">Clubspot</h1>
                        </div>
                    </div>
                    
                        <div class="flexWrap hideForPrinting">
                            <div class="product-card onWhite has-photo overflowHidden easeFast relative fff maxThreeHundo boxShadowOnHover">
                                <div class="flexNoWrap">
                                    <div class="successIcon tinyIcon active noMarginLeft"></div>
                                    <p class="product-card-label smallerMarginLeft">Easy to learn</p>
                                </div>
                                <p class="product-card-explain">Find out why hundreds of clubs have made the switch from Regatta Network, Yachtscoring, and SailWave.</p>
                                <button class="primaryButton outline easeFast boxShadowBottom smallMarginTop relative">
                                    Learn more
                                    <a class="absoluteA" href="/product-regattas"></a>
                                </button>
                            </div>
                            <div class="product-card onWhite has-photo overflowHidden easeFast relative fff maxThreeHundo boxShadowOnHover">
                                <div class="flexNoWrap">
                                    <div class="successIcon tinyIcon active noMarginLeft"></div>
                                    <p class="product-card-label smallerMarginLeft">Handicap Scoring</p>
                                </div>
                                <p class="product-card-explain">Score PHRF, ORC, IRC, Portsmouth, Pursuit, Club Series, and more.</p>
                                <button class="primaryButton outline easeFast boxShadowBottom smallMarginTop relative">
                                    Schedule a demo
                                    <a class="absoluteA tapped_schedule_demo" data-demo-type="regattas_demo"></a>
                                </button>
                            </div>
                            <div class="product-card onWhite has-photo overflowHidden easeFast relative fff maxThreeHundo boxShadowOnHover">
                                <div class="flexNoWrap">
                                    <div class="successIcon tinyIcon active noMarginLeft"></div>
                                    <p class="product-card-label smallerMarginLeft">One-Design Scoring</p>
                                </div>
                                <p class="product-card-explain">Score one-design fleets of all sizes, from any device - even from the water.</p>
                                <button class="primaryButton outline easeFast boxShadowBottom smallMarginTop relative">
                                    Schedule a demo
                                    <a class="absoluteA tapped_schedule_demo" data-demo-type="regattas_demo"></a>
                                </button>
                            </div>
                        </div>
                    
                </div>
            </div>
            <div 
                v-if="!loading.results"
                class="toolbar-v2-icon active smallMarginBottom hideForPrinting" 
                style="width:160px;bottom:20px;margin-bottom:0px;"
            >
                <div class="flexNoWrap drilldownFooterMenu order_table_toggle_wrap easeFast" style="left: 0px; position: fixed;">
                    <div 
                        class="native-tab-bar-item"
                        @click="change_view('responsive')"
                        :class="{ active : this.responsiveView }"
                    >
                        <div class="centeredText centeredBlock">
                            <i class="fa-regular fa-mobile native-tab-bar-icon"></i>
                            <p class="native-tab-bar-label">Responsive</p>
                        </div>
                    </div>
                    <div 
                        class="native-tab-bar-item"
                        @click="change_view('fullscreen')"
                        :class="{ active : !this.responsiveView }"
                    >
                        <div class="centeredText centeredBlock">
                            <i class="fa-regular fa-arrows-left-right native-tab-bar-icon"></i>
                            <p class="native-tab-bar-label">Full screen</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- react native tab bar -->
            <native-tab-bar-component></native-tab-bar-component>

        </div>

        <div id="v-overlays">
            <!-- vue overlays -->
            <template v-if="overlays.handle_common_grid">
                <handle-common-grid></handle-common-grid>
            </template>
            <template v-if="overlays.show_push_notification">
                <show-push-notification></show-push-notification>
            </template>
        </div>

    </body>

    <script>

        //create the app
        store.components["regatta_results"] = {
            //loading
            loading: {
                boat_classes: true,
                results: true
            },
            //boat classes
            selected_class_id: null,
            boat_classes: [],
            //divisions
            selected_division_ids: [],
            single_select_division_id: null,
            show_division_dropdown: false,
            //subevents
            selected_subevent_id: null,
            subevents: [],
            hide_overall_series_tab: false,
            // races
            selected_race: null,
            //results data
            results_data: null,
            last_query: null,
            //other
            responsiveView: true,
            streamers: [],
            nonFinishingLetterScores: ["TLE", "DNF", "DNC", "DNS", "BYE", "NSC", "OCS", "UFD", "BFD", "RET", "DSQ"],

        }
        
        var app_content = createApp({
            data() {
                return store.components["regatta_results"]
            },
            mounted() {
                //show the content
                $('#v-content').removeClass('hidden');
                $(document).scrollTop(0);
                this.hide_overall_series_tab = $('body').data('hide-overall-series-tab');
                //make some promises
                var promise = Promise.resolve();
                var promises = [];
                //boat class promise
                var boat_class_promise = promise.then(()=> {
                    return this.load_boat_classes()
                });
                promises.push( boat_class_promise );
                //streamer promise
                var streamer_promise = promise.then(()=> {
                    return this.load_streamers()
                });
                //subevent promise
                if( $('body').data('has-series-scoring') ){
                    var subevent_promise = promise.then(()=> {
                        return this.load_subevents();
                    });
                    promises.push( subevent_promise );
                }
                //return in parallel
                Promise.all(promises).then(()=>{
                    if( this.hide_overall_series_tab && this.subevents[0] ){
                        this.selected_subevent_id = this.subevents[0].id;
                    }
                    //load results
                    this.load_results();
                });
                //user preferences
                this.load_user_preferences();
                //handle resizing
                window.addEventListener("resize", this.fit_table_to_container); // Adjust table on window resize            
                //handle the divisions dropdown
                window.addEventListener('resize', this.updateDropdownPosition);
                document.addEventListener('click', this.handleClickOutside);
            },
            beforeUnmount() {
                // Remove the event listener when the component is destroyed
                window.removeEventListener("resize", this.fit_table_to_container); // Cleanup event listener
                window.removeEventListener('resize', this.updateDropdownPosition);
                document.removeEventListener('click', this.handleClickOutside);
            },
            methods: {
                race_name( race ){
                    if( race.nickname ){
                        return race.nickname;
                    }
                    return 'Race ' + race.number;
                },
                selected_more_menu_option( option ){
                    switch (option) {
                        case "event_details":
                            window.location.href = "/regatta/" + $('body').data('regatta-id');
                            break;
                        case "list_view":
                            window.location.href = "/regatta/" + $('body').data('regatta-id') + "/results?list_view=true";
                            break;
                        case "print_results":
                            this.$nextTick(() => {
                                window.print();
                            });
                            break;
                        case "copy_results":
                            //copyTableToClipboard( document.getElementById('copy-target-results') );
                            copyTableToClipboard( document.getElementById('table-container') );
                            //display a message
                            displayMessage("The results were copied to your clipboard! You can now paste directly into Google Sheets or Excel for enhanced printing.", false, 15000);
                            break;
                        default:
                            break;
                    }
                },
                return_more_menu_options(){
                    var options = [{
                        text: "Event details",
                        fn: this.selected_more_menu_option,
                        args:[ "event_details" ],
                        icon_class: 'fa-light fa-sailboat',
                    },
                    {
                        text: "List view",
                        fn: this.selected_more_menu_option,
                        args:[ "list_view" ],
                        icon_class: 'fa-light fa-list',
                    },
                    {
                        text: "Print results",
                        fn: this.selected_more_menu_option,
                        args:[ "print_results" ],
                        icon_class: 'fa-light fa-print',
                    },{
                        text: "Copy/paste results",
                        fn: this.selected_more_menu_option,
                        args:[ "copy_results" ],
                        icon_class: 'fa-light fa-copy',
                    }];
                    return [{
                        options: options
                    }]
                },
                view_more(){
                    var params = {};
                    params["title"] = "Select action";
                    params["hide_on_selection"] = true;
                    params["retrieve_sections_fn"] = this.return_more_menu_options;
                    handle_common_grid( params );
                },                
                load_subevents(){
                    var promise = Promise.resolve();
                    var thisPromise = promise.then(()=>{
                        var query = new Parse.Query("subevents");
                        query.equalTo('regattaObject', {
                            "__type": "Pointer",
                            "className": "regattas",
                            "objectId": $('body').data('regatta-id')
                        });
                        query.equalTo('archived', false);
                        query.ascending('priority,createdAt');
                        return query.find();
                    }).then(( retrieved_subevents )=>{
                        this.subevents = retrieved_subevents;
                        return Promise.resolve();
                    }).catch((error)=>{
                        this.check_invalid_session_token(error);
                    });
                    return thisPromise;
                },
                returnScoreDataForRace( number, scoring_data ){
                    var obj;
                    for (var i = scoring_data.length - 1; i >= 0; i--) {
                        var thisRaceNumber = scoring_data[i].race_number;
                        if( thisRaceNumber == number ){
                            obj = scoring_data[i];
                            break;
                        }
                    }
                    return obj;
                },
                score_markup( race, scoring_data ){
                    var scoreSituation = '';
                    var scoreDataForRace = this.returnScoreDataForRace( race.number, scoring_data );
                    if( scoreDataForRace ){
                        //great, this registration has a score recorded for this race
                        if( scoreDataForRace ){
                            if( scoreDataForRace.throwout ){
                                //it's a throwout
                                if( scoreDataForRace.letterScore ){
                                    //it's a letter score
                                    scoreSituation += '<p class="centeredText">[' + scoreDataForRace.letterScore + ' - ' + scoreDataForRace.points + ']</p>';
                                }else{
                                    //it's not a letter score
                                    scoreSituation += '<p class="centeredText">[' + scoreDataForRace.points + ']</p>';
                                }
                            }else{
                                //it's not a throwout
                                if( scoreDataForRace.letterScore ){
                                    //it's a letter score
                                    scoreSituation += '<p class="centeredText">' + scoreDataForRace.letterScore + ' - ' + scoreDataForRace.points + '</p>';
                                }else{
                                    //it's not a letter score
                                    scoreSituation += '<p class="centeredText">' + scoreDataForRace.points + '</p>';
                                }
                            }
                        }
                    }else{
                        scoreSituation += '<p class="incomplete centeredText">-</p>';
                    }
                    return scoreSituation;
                },
                return_master_total( result ){
                    var scoring_data = result.scoring_data || [];
                    let registrationObject = result.registrationObject;
                    var number_of_non_throwouts = 0;
                    for (var i = scoring_data.length - 1; i >= 0; i--) {
                        if( ! scoring_data[i].throwout && scoring_data[i].points ){
                            number_of_non_throwouts ++;
                        }
                    }
                    var masterHandicap = registrationObject.handicap_laserMaster ? registrationObject.handicap_laserMaster : 0;
                    var masterTotal = number_of_non_throwouts * masterHandicap;
                    return masterTotal;
                },
                return_total( result ){
                    var total = result.total || 0;
                    if( this.scoring_config.method == "laserMaster" ){
                        let masterTotal = this.return_master_total( result );
                        total += masterTotal;
                    }
                    return total;
                },
                handicap_markup( registrationObject ){
                    let scoring_method = this.scoring_config.method;
                    if( scoring_method == "phrf" || scoring_method == "pursuit" ){
                        var phrfSituation = '';
                        var markup = returnHandicapMarkupWithOverrides( registrationObject, "phrf" );
                        if( markup.length >= 1 ){
                            phrfSituation += '<p class="centeredText">' + markup + '</p>';
                        } else {
                            phrfSituation += '<p class="incomplete centeredText">None</p>';
                        }
                        return phrfSituation;
                    }else if( scoring_method == "irc" ){
                        var ircSituation = '';
                        if( registrationObject.handicap_irc ){
                            ircSituation += '<p class="centeredText">' + registrationObject.handicap_irc + '</p>';
                        } else {
                            ircSituation += '<p class="incomplete centeredText">None</p>';
                        }
                        return ircSituation;
                    }else if( scoring_method == "orc" ){
                        var orcSituation = '';
                        if( registrationObject.handicap_orc ){
                            orcSituation += '<p>' + registrationObject.handicap_orc + '</p>';
                            if( registrationObject.orc_cert && registrationObject.orc_cert.rms && registrationObject.orc_cert.rms.IssueDate ){
                                const issueDate = new Date(registrationObject.orc_cert.rms.IssueDate)
                                const formattedDate = issueDate.toLocaleDateString("en-US");
                                orcSituation += '<div class="header-callout flexNoWrap" style="margin-left: unset; width: 110px">Issued on: ' + formattedDate + '</div>';
                            }
                        } else {
                            orcSituation += '<p class="incomplete centeredText">None</p>';
                        }
                        return orcSituation;
                    }else if(scoring_method == 'portsmouth_us' || scoring_method == 'portsmouth_uk') {
                        var portsmouthSituation = '';
                        if( registrationObject.handicap_portsmouth ){
                            portsmouthSituation += '<p class="centeredText">' + registrationObject.handicap_portsmouth + '</p>';
                        } else {
                            portsmouthSituation += '<p class="incomplete centeredText">None</p>';
                        }
                        return portsmouthSituation;
                    } else if(scoring_method == 'laserMaster') {
                        var laserMasterSituation = '';
                        if(!isNaN(registrationObject.handicap_laserMaster)) {
                            var masterType = ''
                            if(registrationObject.handicap_laserMaster == 4) {
                                masterType = 'Apprentice - Age 30-44 (4 Points)'
                            } else if(registrationObject.handicap_laserMaster == 3) {
                                masterType = 'Master - Age 45-54 (3 Points)'
                            } else if(registrationObject.handicap_laserMaster == 2) {
                                masterType = 'Grand Master - Age 55-64 (2 Points)'
                            } else if(registrationObject.handicap_laserMaster === 1) {
                                masterType = 'Great Grand Master - Age 65-74 (1 Point)'
                            } else if(registrationObject.handicap_laserMaster === 0) {
                                masterType = 'Legend Master - Age 75+ (0 Points)'
                            }
                            laserMasterSituation += '<p class="leftText">' + masterType + '</p>';
                        } else {
                            laserMasterSituation += '<p class="incomplete centeredText">None</p>';
                        }
                        return laserMasterSituation;
                    }
                    return null;
                },
                unset_selected_division_ids(){
                    this.selected_division_ids = [];
                    this.load_results();
                },
                subevent_changed(){
                    this.show_division_dropdown = false;
                    this.load_results();
                },
                class_changed(){
                    this.show_division_dropdown = false;
                    this.selected_division_ids = [];
                    this.single_select_division_id = null;
                    this.selected_race = null;
                    this.load_results();
                },              
                clicked_division_option( division ){
                    if( this.selected_division_ids.indexOf( division.id ) >= 0 ){
                        this.selected_division_ids = this.selected_division_ids.filter((id)=>{
                            return id != division.id;
                        });
                    }else{
                        this.selected_division_ids.push( division.id );
                    }
                    this.load_results();
                },
                toggleFilterDropdown() {
                    this.show_division_dropdown = !this.show_division_dropdown;
                },
                handleClickOutside(event) {
                    const dropdown = this.$refs.filterDropdown;
                    const button = this.$refs.division_filter_button;

                    // Check if the click target is outside both the dropdown and the button
                    if (
                        dropdown &&
                        button &&
                        !dropdown.contains(event.target) &&
                        !button.contains(event.target)
                    ) {
                        this.show_division_dropdown = false;
                    }
                },
                updateDropdownPosition() {
                    const button = this.$refs.division_filter_button;
                    const dropdownElement = this.$refs.filterDropdown;
                    if (button && dropdownElement) {
                        const rect = button.getBoundingClientRect();
                        const screenWidth = window.innerWidth;
                        if (screenWidth < 500) {
                            // Center the dropdown horizontally on small screens
                            dropdownElement.style.left = `20px`;
                            dropdownElement.style.right = `20px`;
                        } else {
                            // Align dropdown with the button on larger screens
                            dropdownElement.style.left = `${rect.left + window.scrollX}px`;
                            dropdownElement.style.right = 'auto';
                        }
                        dropdownElement.style.top = `${rect.bottom + 10}px`; // Align to the bottom of the parent
                    }
                },
                update_selected_division(){
                    if( this.single_select_division_id && this.single_select_division_id != "all" ){
                        this.selected_division_ids = [ this.single_select_division_id ];
                    }else{  
                        this.selected_division_ids = [];
                    }
                    this.selected_race = null;
                    this.load_results();
                },
                load_streamers(){
                    var query = new Parse.Query( 'streamers' );
                    query.ascending('priority');
                    query.equalTo('custom', false);
                    return query.find().then(( retrieved_streamers )=>{
                        this.streamers = retrieved_streamers;
                        return Promise.resolve();
                    }).catch((error)=>{
                        this.check_invalid_session_token(error);
                    });
                },
                divisions_markup( registrationObject ){
                    var divisionSituation = '';
                    var subclassesArray = registrationObject.subclassesArray;
                    if( subclassesArray ){
                        divisionSituation += '<p class="print_smallPadding maxTwoHundo preWrap">';
                        var didPlugDivision = false;
                        for (var i = 0; i <= subclassesArray.length - 1; i++) {
                            var thisSubclass = subclassesArray[i];
                            if( thisSubclass ){
                                if( thisSubclass.name ){
                                    if( didPlugDivision ){
                                        divisionSituation += '<br>';
                                    }
                                    divisionSituation += thisSubclass.name;
                                    didPlugDivision = true;
                                }
                            }
                        }
                        divisionSituation += '</p>';
                    }else{
                        divisionSituation += '<p class="incomplete">None</p>';
                    }
                    return divisionSituation;
                },
                fleet_markup( registrationObject ){
                    //show a fleet assignment
                    var streamerObject = returnLatestStreamerObjectForRegistration( registrationObject, this.streamers, this.selected_class );
                    if( streamerObject ){
                        return returnBadgeForStreamerObject( streamerObject );
                    }else{
                        return '<p class="incomplete streamer-assignment easeFast">None</p>';
                    }
                },
                race_label( race ){
                    if ( race && race.nickname ){
                        return race.nickname;
                    }
                    return "R" + race.number;
                },
                sailor_names( registrationObject ){
                    //updated march 4 2025 to always use order of participantNames
                    var participantsString = '';
                    var participantNames = registrationObject.participantNames;
                    if( ! participantNames ){
                        participantNames = [];
                    }
                    if( participantNames.length == 0 ){
                        var this_string = '';
                        if( registrationObject.firstName ){
                            this_string += registrationObject.firstName;
                        }
                        if( registrationObject.lastName ){
                            if( this_string.length > 0 ){
                                this_string += ' ';
                            }
                            this_string += registrationObject.lastName;
                        }
                        if( this_string.length > 0 ){
                            participantNames.push( this_string );
                        }
                    }
                    for(var i = 0; i < participantNames.length; i++) {
                        var this_name = participantNames[i] || '';
                        if( participantsString.length >= 1 ){
                            participantsString += '<br>';
                        }
                        participantsString += this_name.trim();
                    }
                    if(this.result_fields.hide_crew) {
                        participantsString = participantsString.split('<br>')[0];
                    }
                    return participantsString;
                },
                sail_number( registrationObject ){
                    var sailNumberSituation = '';
                    if( registrationObject.sailNumber ){
                        if( registrationObject.sailNumber_country && this.result_fields.countryCode ){
                            sailNumberSituation += '<p class="uppercase">';
                            sailNumberSituation += registrationObject.sailNumber_country.toUpperCase();
                            sailNumberSituation += ' ' + registrationObject.sailNumber;
                            sailNumberSituation += '</p>';
                        }else{
                            sailNumberSituation += '<p class="uppercase">' + registrationObject.sailNumber + '</p>';
                        }
                        if( registrationObject.bowNumber ){
                            sailNumberSituation += '<p class="tableCellSubtext">'+registrationObject.bowNumber+'</p>';
                        }
                    }else{
                        sailNumberSituation += '<p class="incomplete">None</p>';
                    }
                    return sailNumberSituation;
                },
                load_boat_classes(){
                    var query = new Parse.Query("boatClasses");
                    query.equalTo('regattaObject', {
                        "__type": "Pointer",
                        "className": "regattas",
                        "objectId": $('body').data('regatta-id')
                    });
                    query.equalTo('archived', false);
                    query.ascending('name');
                    query.include('subclassesArray');
                    return query.find().then(( retrieved_classes )=>{
                        this.boat_classes = retrieved_classes.filter((boat_class)=>{
                            if( boat_class.get('scoring') && boat_class.get('scoring').method == "not_racing" ){
                                return false;
                            }
                            return true
                        });
                        if( this.boat_classes[0] ){
                            //preselect the first one
                            this.selected_class_id = this.boat_classes[0].id;
                        }
                        this.loading.boat_classes = false;
                    }).catch((error)=>{
                        this.check_invalid_session_token(error);
                        displayMessage(error.message, true, 6000);
                    });
                },
                load_results(){
                    $(document).scrollTop(0);
                    if( this.selected_class_id ){
                        //go get the results
                        var timestamp = new Date().getTime();
                        this.last_query = timestamp;
                        this.loading.results = true;
                        this.fit_table_to_container();
                        //set a base url
                        const cutoffDate = new Date('2024-12-31T23:59:59.999Z');
                        const regattaStartDate = new Date ($('body').data('regatta').startDate.iso)
                        let url
                        if(regattaStartDate > cutoffDate) {
                            url = "https://results.theclubspot.com/clubspot-results-v4/" + $('body').data('regatta-id') + "?boatClassIDs=" + this.selected_class_id;
                        }else{
                            url = "https://results.theclubspot.com/clubspot-results-v3/" + $('body').data('regatta-id') + "?boatClassIDs=" + this.selected_class_id;
                        }
                        //and see if a single division is selected (for recalculate_scores_within_division option)
                        if( this.scoring_config.recalculate_scores_within_division == "true" ){
                            //ok, they want to recalculate scores within the division
                            let division_ids = this.selected_division_ids;
                            if( division_ids[0] ){
                                //ok, we should show scores recalculated for this division only
                                url += "&division_id=" + division_ids[0];
                            }
                        }
                        //see if we have any subevents selected (which means we should look at specific race numbers only)
                        if( this.selected_subevent ){
                            url += "&sub_event_id=" + this.selected_subevent.id;
                            if( this.selected_subevent.get('race_numbers') ){
                                url += "&valid_race_numbers=" + this.selected_subevent.get('race_numbers').join('-');
                            }
                        }
                        //look for results
                        return fetch( url , {
                            method: 'GET'
                        }).then((data) => {
                            return data.json();
                        }).then((response) => {
                            if( this.last_query == timestamp ){
                                this.loading.results = false;
                                this.results_data = response;
                                this.fit_table_to_container();
                            }
                        }).catch((error)=>{
                            this.check_invalid_session_token(error);
                            displayMessage(error.message, true, 8000);
                        });
                    }
                },
                load_user_preferences() {
                    let storedView = localStorage.getItem('results_view');
                    this.responsiveView = storedView === 'responsive';
                },
                save_user_preferences(mode) {
                    localStorage.setItem('results_view', mode);
                },
                change_view(mode){
                    this.responsiveView = mode === 'responsive';
                    this.$nextTick(() => {
                        this.fit_table_to_container();
                        $(document).scrollTop(0);
                    })
                    // check to see if they are logged in and save this preference
                    this.save_user_preferences( mode )
                },
                fit_table_to_container() {
                    this.$nextTick(() => {
                        const table = this.$refs.table;
                        const container = this.$refs.tableContainer;
                        if( container && table ){
                            //check the view
                            if( this.responsiveView ){
                                table.style.transform = 'none';
                                container.style.height = 'auto';
                            }else{
                                const containerWidth = container.offsetWidth;
                                const tableWidth = table.offsetWidth;
                                const desktopScale = containerWidth / tableWidth; // Calculate scale to fit
                                table.style.transform = `scale(${desktopScale})`;
                                table.style.transformOrigin = 'top left';
                                //and adjust the container's height
                                this.$nextTick(() => {
                                    const tableHeight = table.offsetHeight * desktopScale; // Scaled height
                                    container.style.height = `${tableHeight}px`; // Update container height
                                });
                                /*
                                // Adjust the container's height to match the scaled table height
                                const tableHeight = table.offsetHeight * desktopScale; // Scaled height
                                container.style.height = `${tableHeight}px`; // Update container height
                                */
                            }
                        }
                    })
                },
                filterRegistrationsBySelectedSubclasses( scoresByRegistration ){
                    var filtered = [];
                    for (var i = 0; i <= scoresByRegistration.length - 1; i++) {
                        var registration_scoring_data = scoresByRegistration[i];
                        var registrationObject = registration_scoring_data.registrationObject;
                        if( registrationObject ){
                            var matches = this.returnRegistrationMatchesAtLeastOneSubclass( registrationObject );
                            if( matches ){
                                filtered.push( registration_scoring_data );
                            }
                        }
                    }
                    return filtered;
                },
                returnRegistrationMatchesAtLeastOneSubclass( registrationObject ){
                    var matches = false;
                    if( registrationObject ){
                        if( this.selected_division_ids.length <= 0 ){
                            //all subclasses selected
                            matches = true;
                        }else{
                            //not all subclasses are selected
                            var subclassesArray = registrationObject.subclassesArray;
                            if( subclassesArray ){
                                for (var i = subclassesArray.length - 1; i >= 0; i--) {
                                    var thisSubclass = subclassesArray[i];
                                    if( thisSubclass ){
                                        if( this.selected_division_ids.includes( thisSubclass.objectId ) ){
                                            matches = true;
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    return matches;
                },
                check_invalid_session_token(error){
                    if(error.code === 209){
                        // Invalid session token: log out the user and reload
                        return Parse.User.logOut().then(() => {
                            window.location.reload();
                        });
                    }   
                },
                format_start_or_finish_time(time){
                    return formatStartOrFinishTime(time)
                },
                return_time_for_milliseconds(time) {
                    return returnTimeForMilliseconds(time)
                },
                return_delta(score){
                    let firstBoatFinishTime = this.single_race_results[0].score.corrected_time;
                    let currentBoatFinishTime = score.corrected_time;
                    return firstBoatFinishTime - currentBoatFinishTime;
                },
                return_pursuit_elapsed_time(score){
                    return new Date(score.finish_time).getTime() - new Date(score.pursuitStart).getTime();
                },
                return_handicap(registration){
                    let handicap
                    let handicapType = registration.boatClassObject.scoring.method
                    if(handicapType == 'phrf' || handicapType == "pursuit") {
                        handicap = returnHandicapForRegistrationAndRace_json_version( registration, this.selected_race.number, "phrf" );
                    } else if(handicapType == 'irc') {
                        handicap = returnHandicapForRegistrationAndRace_json_version( registration, this.selected_race.number, "irc" );
                    } else if(handicapType == 'orc') {
                        // find the relavant start data
                        let startData
                        if( this.single_race_start_details && this.single_race_start_details.length == 1){
                            startData = this.single_race_start_details[0];
                        }
                        handicap = returnHandicapForRegistrationAndRace_json_version( registration, this.selected_race.number, "orc", startData );
                    } else if(handicapType == 'portsmouth_us' || handicapType == 'portsmouth_uk') {
                        handicap = returnHandicapForRegistrationAndRace_json_version( registration, this.selected_race.number, "portsmouth" );
                    } else if(handicapType == 'laserMaster') {
                        handicap = registration.handicap_laserMaster;
                    }
                    return handicap
                },
                return_format_timespant_date(date){            
                    return formatTimestampDate(date)
                },
                return_string_for_scoring_method(scoringMethod){
                    return returnStringForScoringMethod(scoringMethod)
                },
                race_changed(){
                    this.fit_table_to_container()
                },
                tapped_view_race_specific_results(race){
                    this.selected_race = race
                    this.race_changed()
                },
                nice_orc_course_option
            },
            watch: {
                show_division_dropdown(){
                    this.updateDropdownPosition();
                },  
            },
            computed:{
                selected_divisions(){
                    if( this.divisions && this.selected_division_ids.length >= 1 ){
                        return this.divisions.filter((division)=>{
                            return this.selected_division_ids.includes( division.id );
                        });
                    }
                },
                selected_divisions_string(){
                    if( this.selected_divisions && this.selected_divisions.length >= 1 ){
                        return this.selected_divisions.map((division)=>{
                            return division.get('name');
                        }).join(', ');
                    }
                    return 'All divisions';
                },
                show_race_links(){
                    var handicap = ["phrf", "irc", "portsmouth_us", "portsmouth_uk", "pursuit", "orc"];
                    return handicap.includes( this.scoring_config.method );
                },
                allow_division_multi_select(){
                    return this.scoring_config.recalculate_scores_within_division != "true";
                },
                sorted_and_filtered_results(){
                    if( this.scores_by_registration ){
                        let filtered = this.scores_by_registration;
                        //now sort
                        var finalRace = null;
                        if( this.scoring_config.method == "one_design_with_fleets" ){
                            finalRace = this.scoring_config.finals_start;
                        }
                        var raceNum = this.highest_race_number;
                        if( finalRace && raceNum && raceNum >= 0 && Number(raceNum) >= Number(finalRace)) {
                            return filtered.sort( sortRegistrationsByNetPoints_finals );
                        } else {
                            return filtered.sort( sortRegistrationsByNetPoints );
                        }
                    }
                    return [];
                },
                handicap_label(){
                    var scoring_method = this.scoring_config.method;
                    switch (scoring_method) {
                        case "phrf":
                            return "PHRF Rating";
                            break;
                        case "pursuit": 
                            return "PHRF Rating";
                            break;
                        case "irc": 
                            return "IRC Rating";
                            break;
                        case "portsmouth_us":
                            return "Portsmouth Rating";
                            break;
                        case "portsmouth_uk":
                            return "Portsmouth Rating";
                            break;
                        case "orc":
                            return "ORC Rating";
                            break;
                        default:
                            break;
                    }
                    return null
                },
                divisions(){
                    if( this.selected_class && this.selected_class.get('subclassesArray') ){
                        return this.selected_class.get('subclassesArray');
                    }
                    return [];
                },
                scoring_config(){
                    if( this.selected_class ){
                        return this.selected_class.get('scoring');
                    }
                    return {};
                },
                nice_as_of_date(){
                    if( this.results_data && this.results_data.last_cached ){
                        var date = new Date( this.results_data.last_cached );
                        return "As of "+ formatTimestampDate( date );
                    }
                    return "As of "+ formatTimestampDate( new Date() );
                },
                selected_class(){
                    if( this.selected_class_id ){
                        return this.boat_classes.find((boat_class)=>{
                            return boat_class.id == this.selected_class_id;
                        });
                    }
                    return null;
                },
                selected_subevent(){
                    if( this.selected_subevent_id ){
                        return this.subevents.find((subevent)=>{
                            return subevent.id == this.selected_subevent_id;
                        });
                    }
                    return null;
                },
                selected_subevent_name(){
                    if( this.selected_subevent ){
                        return this.selected_subevent.get('name');
                    }
                    return 'Overall Series';
                },
                selected_class_name(){
                    if( this.selected_class ){
                        return this.selected_class.get('name');
                    }
                    return 'Select a class';
                },
                selected_race_name(){
                    if( this.selected_race ){
                        return this.race_name( this.selected_race )
                    }
                    return 'Cumulative results';
                },
                result_fields(){
                    if( this.selected_class && this.selected_class.get('resultFields') ){
                        return this.selected_class.get('resultFields');
                    }
                    return {
                        boatName: true,
                        clubOrg: true,
                        boatColor: false,
                        spinnakerColor: false,
                        loa: false,
                        boatType: false,
                        countryCode: true
                    }
                },
                races(){
                    if( this.results_data && this.results_data.races ){
                        return this.results_data.races;
                    }
                    return [];
                },
                scores_by_registration(){
                    if( this.results_data && this.results_data.scoresByRegistration ){
                        var copy = [...this.results_data.scoresByRegistration];
                        //filter out any without scores
                        var filtered = filterRegistrationsWithoutAnyScores( copy );
                        //see if we should filter by subclass
                        if( this.divisions.length >= 1 ){
                            filtered = this.filterRegistrationsBySelectedSubclasses( filtered );
                        }
                        //return it
                        return filtered;
                    }
                    return [];
                },
                single_race_results(){
                    if( ! this.results_data ){
                        this.results_data = {};
                    }
                    var allScores = this.results_data.scoresByRegistration;
                    var raceData = [];
                    let highestHandicap = 0;
                    let raceDistance;
                    let startTime;
                    let thisRaceScore;
                    for(var i = 0; i < allScores.length; i++) {
                        var thisRegistration = allScores[i].registrationObject;
                        var thisPhrf = returnHandicapForRegistrationAndRace_json_version( thisRegistration, Number(this.selected_race.number), "phrf" )
                        if( thisPhrf > highestHandicap) {
                            highestHandicap = thisPhrf;
                        }                 
                        if(allScores[i].scoring_data) {
                            thisRaceScore = allScores[i].scoring_data.filter((r) => {return r.race_number == this.selected_race.number })[0];    
                        }
                        if(thisRegistration && thisRaceScore) {
                            raceData.push({registration: thisRegistration, score: thisRaceScore});
                        }
                        if(!raceDistance && thisRaceScore){
                            raceDistance = thisRaceScore.start_data.distance;
                        }
                        if(!startTime && thisRaceScore) {
                            startTime = new Date(thisRaceScore.start_data.start_time);
                        }
                    }
                    let timeForSlowestBoat = raceDistance * highestHandicap * 1000;
                    raceData.forEach(data => {
                        let thisRaceScore = data.score;
                        let thisRegistration = data.registration;
                        let thisPhrf = returnHandicapForRegistrationAndRace_json_version( thisRegistration, Number(this.selected_race.number), "phrf" )
                        let timeForThisBoat = raceDistance * thisPhrf * 1000;
                        let diff = timeForSlowestBoat - timeForThisBoat;
                        let newStart = new Date((startTime.getTime() + diff) );
                        thisRaceScore.pursuitStart = newStart;
                    });
                    if(raceData.length === 0) {
                        displayMessage('No results posted for race ' + this.selected_race.number + ".", true, 3000);
                        return raceData;
                    }
                    //sort by corrected time (unless pursuit)
                    raceData = raceData.sort((a, b) => {
                        var a_didnt_finish = false;
                        if(a.score && a.score.letterScore && this.nonFinishingLetterScores.indexOf( a.score.letterScore ) >= 0 ){
                            a_didnt_finish = true;
                        }
                        var b_didnt_finish = false;
                        if( b.score && b.score.letterScore && this.nonFinishingLetterScores.indexOf( b.score.letterScore ) >= 0 ){
                            b_didnt_finish = true;
                        }
                        if( a_didnt_finish != b_didnt_finish ){
                            return a_didnt_finish > b_didnt_finish ? 1 : -1;
                        }
                        var timeOne = a.score.corrected_time ? a.score.corrected_time : 9999999999;
                        var timeTwo = b.score.corrected_time ? b.score.corrected_time : 9999999999;
                        return timeOne - timeTwo;
                    });
                    return raceData
                },                
                single_race_start_details(){
                    if(this.single_race_results && this.single_race_results.length > 0){
                        let relevantStarts = this.single_race_results[0].score.start_data.relevant_starts.map(x => x.objectId);
                        let start_data = []
                        relevantStarts.forEach(startId => {
                            //find score that was part of current start
                            for (let i = 0; i < this.single_race_results.length; i++) {
                                if(this.single_race_results[i].score.start_data.start_id == startId){
                                    start = this.single_race_results[i].score.start_data
                                    break
                                }
                            }
                            start.race_number = this.single_race_results[0].score.race_number;
                            start.scoring = this.single_race_results[0].registration.boatClassObject.scoring; //make markup
                            start_data.push(start)
                        });
                        return start_data || null;
                    }
                    return null
                },
                isPursuitRace(){
                    return this.scoring_config.method == "pursuit";
                },
                highest_race_number(){
                    return returnHighestRaceNumber( this.races );
                },
                lowest_race_number(){
                    return returnLowestRaceNumber( this.races );
                },                        
            }
        });

        //overlays app
        var app_overlays = createApp({
            data() {
                return store
            },
            mounted() {
                console.log("mounted vue app: overlays");
            },
        });

    </script>

    <!-- native tab bar -->
    <!DOCTYPE html>
<html lang="en">
    <script type="text/html" id="template-bottom-sheet-overlay">

    <div 
        class="v-overlay scrollable hugePaddingBottom active" 
        @touchstart.self="touched_overlay()"
        @mousedown.self="touched_overlay()"
        @click.self="clicked_overlay()"
    >
        <div 
            class="standardOverlayCard centeredBlock bottom-sheet"
            :class="{'short': height == 'short'}"
        >

            <!-- generic header content -->
            <div class="bottom-sheet-overlay-header">
                <div 
                    class="relative"
                >
                    <div 
                        class="overlay-header-handle-wrap centeredBlock"
                        @click.stop="toggle_height()" 
                    >
                        <div class="overlay-header-handle"></div>
                    </div>
                    <i 
                        class="overlay-x-button fa-regular fa-xmark pointer"
                        @click.stop="dismiss_overlay()"
                    ></i>
                </div>

                <!-- header content injected here -->
                <slot name="header"></slot>

            </div>

            <!-- body content injected here -->
            <slot name="body"></slot>

            <!-- footer content injected here -->
            <slot name="footer"></slot>

        </div>
    </div>

</script>

<style>

    .standardOverlayCard.bottom-sheet{
        position: fixed;
        bottom: 0px;
        top: 50px;
        left: 0px;
        right: 0px;
        z-index: 1001;
        /*
        background-color: rgba(249, 251, 251, 1);
        */
        background-color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: bottom 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        padding-bottom: 10px;
        padding-top: 10px;
        max-width: 1100px;
        margin-top: 0px;
        border-bottom-left-radius: 0px;
        border-bottom-right-radius: 0px;
    }

    .standardOverlayCard.bottom-sheet.short{
        top: 50%;
    }

    @media (max-height: 600px) {

        .standardOverlayCard.bottom-sheet.short{
            top: 150px;
        }

    }

    .standardOverlayCard.bottom-sheet h3{
        padding-top:0px;
    }

    .standardOverlayCard.bottom-sheet{
        display: flex;
        flex-direction: column;
        padding-bottom:0px;
        padding-top: 0px;
    }

    .standardOverlayCard.bottom-sheet .bottom-sheet-overlay-card-header
    {
        flex: 0 0 auto; /* Fixed height, doesn't grow or shrink */
    }

    .standardOverlayCard.bottom-sheet .standardCardFooter{
        position: absolute;
        bottom: 0px;
        left: 0px;
        right: 0px;
        background-color: #fff;
        border-top: 1px solid #e4ebf1;
        z-index: 10;
    }

    .standardOverlayCard.bottom-sheet .standardCardBody{
        flex: 1 1 auto; /* Flexible height, can grow and shrink */
        padding-bottom: 90px !important;
    }

    .overlay-header-handle-wrap{
        padding: 10px;
        cursor: pointer;
        max-width: 120px;
    }
    .overlay-header-handle{
        width: 70px;
        height: 3px;
        border-radius: 10px;
        background-color: #acb3ba;
        margin-left: auto;
        margin-right: auto;
        margin-top: 8px;
        margin-bottom: 8px;
    }
    .overlay-x-button{
        position: absolute;
        right: 14px;
        color: #535e6c;
        font-size: 20px;
        top: 14px;
    }

</style>

<script>

    //define the component
    app_overlays.component("bottom-sheet-overlay", {
        template: "#template-bottom-sheet-overlay",
        data() {
            return {
                height: "tall"
            }
        },
        mounted(){
            const universalEditOverlay = document.getElementById('overlay_universal-edit');
            if (universalEditOverlay) {
                universalEditOverlay.style.zIndex = "1000000";
            }
            const membershipValidationOverlay = document.getElementById('overlay_verifyMembership');
            if (membershipValidationOverlay) {
                membershipValidationOverlay.style.zIndex = "1000000";
            }
        },
        beforeUnmount() {
            //reset the z-index
            const universalEditOverlay = document.getElementById('overlay_universal-edit');
            if (universalEditOverlay) {
                universalEditOverlay.style.zIndex = ""; // Revert to default
            }
            const membershipValidationOverlay = document.getElementById('overlay_verifyMembership');
            if (membershipValidationOverlay) {
                membershipValidationOverlay.style.zIndex = ""; // Revert to default
            }
        },
        methods: {
            dismiss_overlay(){
                this.$emit('dismiss_overlay');
            },
            toggle_height(){
                if( this.height == "tall" ){
                    this.height = "short";
                }else{
                    this.height = "tall";
                }
            },
            clicked_overlay(){
                if (should_close_overlay(this.last_touch)) {
                    this.dismiss_overlay();
                }
            },
            touched_overlay(){
                this.last_touch = new Date().getTime();
            },
        },
    });
    
</script>    <script type="text/html" id="template-show-push-notification">
	
    <bottom-sheet-overlay
        @dismiss_overlay="dismiss_overlay()"
    >

        <!-- header content -->
        <template #header>
            <div class="flexNoWrap">
                <h3 
                    class="flexGrowOne" 
                    style="padding-bottom:0px;"
                >
                    <p>{{ payload.title }}</p>
                    <template v-if="has_date">
                        <p 
                            class="card-header-subtext pointer"
                        >{{ date_string }}</p>
                    </template>
                </h3>
            </div>
        </template>

        <!-- body content -->
        <template #body>
            <div 
                class="standardCardBody fff scrollable"
            >
                <p class="p-1" style="margin: 0px 8px;">{{ payload.alert }}</p>
            </div>
        </template>

        <!-- footer content -->
        <template 
            #footer
        >
            <div 
                class="standardCardFooter flexNoWrap"
            >
                <div class="flexGrowOne"></div>
                <button class="marketing-header-button blue easeSuperFast flexWrapLeftAlign align-items-center" @click="dismiss_overlay()" >Done</button>
            </div>
        </template>

    </bottom-sheet-overlay>

</script>

<script>

    function show_push_notification( params ){
        store.components.show_push_notification.payload = params.payload;
        store.overlays.show_push_notification = true;
    }

    //add a value to our global store, specific to this component
    store.components["show_push_notification"] = {
        payload: null
    }

    //define the component
    app_overlays.component("show-push-notification", {
        template: "#template-show-push-notification",
        data() {
            return store.components.show_push_notification;
        },
        mounted() {
        },
        methods: {
            dismiss_overlay(){
                store.overlays.show_push_notification = false;
            } 
        },
        computed: {
            has_date(){
                return this.payload.utcDate !== undefined;
            },
            date_string(){
                const { utcDate } = this.payload;

                if (! utcDate){
                    return undefined;
                }

                if ( is_utc_date_today( utcDate ) ){
                    return format_utc_date_v2({
                        "utcDate": utcDate,
                        "formatString": "[Today at] h:mm A"
                    });
                } else {
                    return format_utc_date_v2({
                        "utcDate": utcDate,
                        "formatString": "ddd M/D h:mm A"
                    });
                }
            }
        }
    });

</script>    <script type="text/html" id="template-native-tab-bar">

    <!-- first, make sure we're in the react native member app -->
    <template v-if="is_react_native_member_app">
            
        <div 
            v-if="show_tab_bar"
            class="native-tab-bar-outer flexNoWrap"
        >
            <!-- tab bar (only for the member portal) -->
            <template v-if="visible_tabs">
                <div 
                    v-for="tab in visible_tabs"
                    :key="tab.key"
                    class="native-tab-bar-item"
                    :class="{ active : tab.key == primary_view }"
                    @touchstart.prevent="tapped_tab_bar_item( tab )"
                    @click="tapped_tab_bar_item( tab )"
                >
                    <div class="centeredText centeredBlock">
                        <p><i class="native-tab-bar-icon" :class="tab.icon_class"></i></p>
                        <p class="native-tab-bar-label">{{ tab.label }}</p>
                    </div>
                </div>
                <div 
                    class="native-tab-bar-item"
                    @touchstart.prevent="tapped_more()"
                    @click="tapped_more()"
                >
                    <div class="centeredText centeredBlock">
                        <p><i class="fa-regular fa-grid native-tab-bar-icon"></i></p>
                        <p class="native-tab-bar-label">More</p>
                    </div>
                </div>
            </template>
        </div>

        <!-- back button (global) -->
        <div v-else-if="! loading && show_back_button">

            <!-- overlay -->
            <div 
                class="native-tab-bar-back-button-overlay pointer"
                @touchstart.self.prevent="back_button_expanded = false"
                @click.self="back_button_expanded = false"
                :class="{ 'active': back_button_expanded }"
            ></div>

            <!-- home button -->
            <div 
                class="native-tab-bar-floating-home-button boxShadowBottom moreBlur pointer easeFast"
                @click="tapped_home()"
                :class="{ 'active': back_button_expanded }"
            >
                <div class="centeredText centeredBlock">
                    <p><i class="fa-regular fa-house native-tab-bar-icon" style="font-size:20px;"></i><span v-if="back_button_expanded" style="padding-left:6px;font-size:18px;">Home</span></p>
                </div>
            </div>

            <!-- back button -->
            <div 
                class="native-tab-bar-floating-back-button boxShadowBottom moreBlur pointer easeFast"
                @click="tapped_back()"
                :class="{ 'expanded': back_button_expanded }"
            >
                <div class="centeredText centeredBlock">
                    <p><i class="fa-regular fa-chevron-left native-tab-bar-icon" style="font-size:20px;"></i><span v-if="back_button_expanded" style="padding-left:6px;font-size:18px;">Back</span></p>
                </div>
            </div>

            <!--
            <div 
                class="native-tab-bar-item"
                @click="tapped_home()"
                style="max-width:60px;"
            >
                <div class="centeredText centeredBlock">
                    <p><i class="fa-regular fa-house native-tab-bar-icon"></i></p>
                    <p class="native-tab-bar-label">Home</p>
                </div>
            </div>
            -->
        </div>

        <!-- full menu sheet -->
        <div 
            v-if="tabs"
            class="native-tab-bar-menu-sheet"
            :class="{'active': show_full_menu}"
        >
            <!-- overlay -->
            <div 
                class="native-tab-bar-menu-sheet-overlay pointer"
                @touchstart.self.prevent="show_full_menu = false"
                @click.self="show_full_menu = false"
            ></div>
            <!-- actual menu sheet -->
            <div class="native-tab-bar-menu-sheet-inner scrollable">
                <div 
                    class="flexWrap"
                    style="padding-top: 10px"
                >
                    <!-- loop through tabs-->
                    <div 
                        v-for="tab in tabs"
                        class="quick-action-wrap noMaxWidth relative"
                        @click="selected_full_menu_option( tab )"
                    >
                        <div 
                            class="quick-action-icon-wrap overflowHidden"
                        >
                            <div>
                                <i v-if="tab.icon_class" :class="tab.icon_class"></i>
                            </div>
                        </div>
                        <p class="quick-action-title">{{ tab.label }}</p>
                    </div>
                </div>
            </div>
        </div>

    </template>
    
</script>


<style>

    .native-tab-bar-outer{
        position: fixed;
        bottom: 0px;   
        left: 0px;
        right: 0px;
        background-color: rgba(249, 251, 251, 1);
        border-top: 1px solid #e4ebf1;
        z-index: 1000;
        transition: 0.15s cubic-bezier(0.25, 0.1, 0.25, 1);
    }
    .native-tab-bar-item{
        padding: 11px;
        display: flex;
        flex: 1 1 0; /* flex-grow: 1; flex-shrink: 1; flex-basis: 0; */
        color: #697684;
        cursor: pointer;
    }
    .native-tab-bar-item.active{
        color: #4a56f8;
    }
    .native-tab-bar-label{
        font-size: 12px;
        padding-top: 4px;
        white-space: nowrap;
    }
    .native-tab-bar-icon{
        font-size: 22px;
    }

    /* ------  menu sheet (full menu)  ------- */

    .native-tab-bar-menu-sheet-overlay{
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(8,8,19,0.64);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.15s ease;
        z-index: 1000;
    }

    .native-tab-bar-menu-sheet.active .native-tab-bar-menu-sheet-overlay{
        opacity: 1;
        visibility: visible;
    }

    .native-tab-bar-menu-sheet.active .native-tab-bar-menu-sheet-inner{
        bottom: 0px;
    }

    .native-tab-bar-menu-sheet-inner .quick-action-wrap{
        padding-left: 10px;
        padding-right:10px;
    }

    .native-tab-bar-menu-sheet-inner{
        position: fixed;
        bottom: -100%;
        max-height: 90%;
        left: 0px;
        right: 0px;
        z-index: 1001;
        background-color: rgba(249, 251, 251, 1);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: bottom 0.15s cubic-bezier(0.25, 0.1, 0.25, 1);
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        padding-bottom: 10px;
        padding-top: 10px;
    }

    /*------  back button  -------*/

    .native-tab-bar-back-button-overlay{
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /*
        background-color: rgba(111,117,122,0.5);
        */
        background-color: rgba(249, 251, 251, 0.8);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.15s ease;
        z-index: 999;
    }

    .native-tab-bar-back-button-overlay.active{
        opacity: 1;
        visibility: visible;
    }

    .native-tab-bar-floating-back-button{
        position: fixed;
        bottom: 15px;
        left: 22px;
        right: auto;
        background-color: rgba(249, 251, 251, 1);
        /* border-top: 1px solid #e4ebf1; */
        z-index: 1000;
        transition: 0.15s cubic-bezier(0.25, 0.1, 0.25, 1);
        border-radius: 100%;
        width: 50px;
        height: 50px;
        background-color: #fff;
        line-height: 50px;
        font-size: 16px;
        white-space: nowrap;
        min-width: 50px;
    }

    .native-tab-bar-floating-back-button.expanded{
        border-radius: 25px;
        padding-left: 16px;
        padding-right: 16px;
        width: auto;
    }

    /*------  home button  -------*/

    .native-tab-bar-floating-home-button.active{
        border-radius: 25px;
        padding-left: 16px;
        padding-right: 16px;
        width: auto;
        visibility: visible;
        opacity: 1;
        animation: expand 0.15s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
        background-color: #4a56f8;
        color: #fff;
    }

    .native-tab-bar-floating-home-button{
        position: fixed;
        bottom: 75px;
        left: 22px;
        right: auto;
        visibility: hidden;
        opacity: 0;
        background-color: rgba(249, 251, 251, 1);
        /* border-top: 1px solid #e4ebf1; */
        z-index: 1000;
        transition: 0.15s cubic-bezier(0.25, 0.1, 0.25, 1);
        border-radius: 20px;
        width: auto;
        height: 50px;
        background-color: #fff;
        line-height: 50px;
        font-size: 16px;
        white-space: nowrap;

        /* Initial state for animation */
        transform: scale(0);
        animation: none;
    }

    /* Keyframes for the expansion effect */
    @keyframes expand {
        from {
            transform: scale(0);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }

</style>

<script>

    app_content.component("native-tab-bar-component", {
        template: "#template-native-tab-bar",
        data() {
            return {
                loading: true,
                last_scroll_top: 0, 
                slide_down: false,
                ticking: false,
                show_full_menu: false,
                back_button_expanded: false
            }
        },
        props: {
            primary_view: String,
            tabs: Array, 
        },
        mounted(){
            if( this.is_react_native_member_app ){
                this.last_scroll_top = this.return_scroll_top();
                window.addEventListener('scroll', this.handle_scroll);
                setTimeout(() => {
                    this.loading = false;
                }, 100);
            }
        },
        unmounted(){
            if( this.is_react_native_member_app ){
                window.removeEventListener('scroll', this.handle_scroll);
            }
        },
        methods: {
            tapped_home(){
                window.location.href = "/account/home";
            },
            tapped_more(){
                this.show_full_menu = true;
            },
            selected_full_menu_option( option ){
                this.show_full_menu = false;
                this.tapped_tab_bar_item( option );
            },
            return_scroll_top(){
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                return scrollTop <= 0 ? 0 : scrollTop; // For Mobile or negative scrolling
            },
            handle_scroll(){
                if ( ! this.ticking ) {
                    window.requestAnimationFrame(() => {
                        let scrollTop = this.return_scroll_top();
                        let windowHeight = window.innerHeight;
                        let documentHeight = document.documentElement.scrollHeight;

                        // Prevent action if bouncing past the bottom of the page
                        if (scrollTop + windowHeight >= documentHeight) {
                            // We're at or past the bottom, so we ignore this scroll event
                            this.ticking = false;
                            return;
                        }
                        
                        if (scrollTop > this.last_scroll_top) {
                            //hide tab bar
                            this.slide_down = true;
                        } else if (scrollTop < this.last_scroll_top && scrollTop >= 0) {
                            //show tab bar
                            this.slide_down = false;
                        }
                        this.last_scroll_top = scrollTop;
                        this.ticking = false;
                    });
                    this.ticking = true;
                }
            },
            tapped_tab_bar_item( tab ){
                updateURL( tab.key );
                displayViewForUrlPath();
            },
            tapped_back(){
                if( this.back_button_expanded ){
                    this.back_button_expanded = false;
                    window.history.back();
                } else {
                    this.back_button_expanded = true;
                }
            },
        },
        computed: {
            //we only show it when we're on one of the relevant primary views (contained in the tab bar)
            //.. otherwise we should display the back button bar
            tab_bar_keys(){
                var keys = [];
                if( this.tabs ){
                    this.tabs.forEach(tab => {
                        keys.push( tab.key );
                    });
                }
                return keys;
            },
            show_tab_bar(){
                for (let t = 0; t < this.tab_bar_keys.length; t++) {
                    if( this.tab_bar_keys[t] == this.primary_view ){
                        return true
                    }   
                }
                return false;
            },
            visible_tabs(){
                if( this.tabs ){
                    return this.tabs.slice(0,4)
                }
                return [];
            },
            show_back_button(){
                if( ! this.show_tab_bar && window.history.length >= 1 ){
                    return true;
                }
                return false;
            },
            is_react_native_member_app(){
                return store.is_react_native_member_app;
            }
        },
    })

</script></html>    <script type="text/html" id="template-handle-common-grid">
    <div 
      id="overlay_handle-common-grid"
      class="v-overlay scrollable hugePaddingBottom active" 
      @click.self="dismiss_overlay()"
    >
        <div class="standardOverlayCard centeredBlock eightyThenNinety">
            <h3>
                {{title}}
                <p v-if="subtext" class="card-header-subtext">{{ subtext }}</p>
            </h3>
            <div 
                class="standardCardBody noPadding fff" 
            >
                <template v-if="! loading">
                    <!-- loop through sections -->
                    <template v-for="section in sections">
                        <p 
                            v-if="section.subtitle"
                            class="section-header-v3"
                        >
                            {{ section.subtitle }}
                        </p>
                        <div 
                            class="flexWrapLeftAlign"
                            style="padding: 20px 10px 12px;"
                        >
                            <div 
                                v-for="option in return_options_for_section( section )"
                                class="quick-action-wrap noMaxWidth relative"
                                @click="selectOption( option.fn, option.args )"
                            >
                                <div 
                                    class="quick-action-icon-wrap overflowHidden relative"
                                >
                                    <!-- iframe thumbnails (specific use case for templates) -->
                                    <div 
                                        v-if="option.id" 
                                        class="thumbnail-container-grid"
                                    >
                                        <div 
                                            class="thumbnail-grid pointer" 
                                            @click="selectOption(option.fn, option.args)"
                                        >
                                            <iframe :src="return_thumbnail_url(option.id)" frameborder="0"></iframe>                                            
                                        </div>
                                    </div>
                                    <!-- iframe thumbnails (specific use case for templates) -->
                                    <div 
                                        v-else-if="option.image_url" 
                                        style="background-size:cover;background-position:center;background-repeat:no-repeat;position:absolute;left:0px;top:0px;right:0px;bottom:0px;"
                                        :style="{ backgroundImage: 'url(' + option.image_url + ')' }"
                                    ></div>
                                    <!-- generic icon -->
                                    <div v-else>
                                        <i v-if="option.icon_class" :class="option.icon_class"></i>
                                    </div>
                                </div>
                                <p class="quick-action-title">{{ option.text }}</p>
                            </div>
                        </div>
                    </template>
                </template>
                <template v-else>
                    <div class="cardBodySpinnerWrap active relative withPadding">
                        <div class="cardBodySpinner centeredBlock"></div>
                    </div>
                </template>
            </div>
            <div class="standardCardFooter flexNoWrap">
                <a 
                    class="cardFooterLink" 
                    @click="dismiss_overlay()"
                >cancel</a>
                <div class="flexGrowOne"></div>
            </div>
        </div>
    </div>
</script>
<script>
    function handle_common_grid( params ){
        //set data
        store.components.handle_common_grid.retrieve_sections_fn = params.retrieve_sections_fn;
        store.components.handle_common_grid.title = params.title || "Select action";
        store.components.handle_common_grid.subtext = params.subtext || "";
        store.components.handle_common_grid.hide_on_selection = params.hide_on_selection || false;
        store.components.handle_common_grid.args = params.args || [];
        //show it
        store.overlays.handle_common_grid = true;
    }
   
    store.components.handle_common_grid = {
        sections: [],
        loading: false,
        retrieve_sections_fn: null,
        hide_on_selection: false,
        args: []
    };

    //define the component
    app_overlays.component("handle-common-grid", {
        template: "#template-handle-common-grid",
        data() {
            return store.components.handle_common_grid
        }, 
        mounted(){
            //handle sections            
            this.handle_sections_on_mounted();           
        },
        methods: {
            handle_sections_on_mounted(){
                //reset them
                this.loading = true;
                this.sections = [];
                //go get them
                var promise = Promise.resolve();
                var thisPromise = promise.then(()=> {
                    if( ! this.retrieve_sections_fn ){
                        return Promise.reject({
                            "message": "No options found."
                        });
                    }
                    //call the function
                    return this.retrieve_sections_fn(...this.args);
                }).then((retrieved_sections)=>{
                    this.sections = retrieved_sections;
                    this.loading = false;
                }).catch((error)=>{
                    checkParseError( error );
                    displayMessage( error.message, true, 6000 );
                });
                return thisPromise;
            },
            return_options_for_section( section ){
                if( section.options ){
                    return section.options;
                }
                return [];
            },
            selectOption(fn, args = []) {
                return (() => {
                    //see if we should dismiss it
                    if( this.hide_on_selection ){
                        store.overlays.handle_common_grid = false;
                    }
                    //need to function call after dismissing 
                    //..overlay incase of opening overlay again
                    fn(...args);
                })();
            },
            return_thumbnail_url(thumbnailId){
                var clubId = store.clubObject ? store.clubObject.id : $('body').data('clubObject').id;
                return "/preview-email-template/" + clubId + "/" + thumbnailId
            },
            dismiss_overlay(){
                store.overlays.handle_common_grid = false;
            },
        }
    });
    
</script>    <script>
        app_content.mount('#v-content');
        app_overlays.mount('#v-overlays');
            
    </script>

    <style>

        .sticky-header{
            background-color: #fff;
            padding-top: 15px;
            padding-bottom: 15px;
            position: sticky;
            top: 0;
            z-index: 12;
        }

        .card-header-button-v3 select{
            color: inherit;
            background-color: inherit;
            font-size: inherit;
            box-shadow: inherit;
            border-radius: 0px;
            padding: 0px;
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            opacity: 0;
        }

        /*
        .native-tab-bar-outer.flexNoWrap.space_between{
            justify-content: space-between;
        }

        .native-tab-bar-outer{
            position: fixed;
            bottom: 0px;   
            left: 0px;
            right: 0px;
            background-color: rgba(249, 251, 251, 1);
            border-top: 1px solid #e4ebf1;
            z-index: 1000;
            transition: 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .native-tab-bar-outer.down{
            bottom: -70px;
        }
        .native-tab-bar-item{
            padding: 11px;
            display: flex;
            flex: 1 1 0;
            color: #697684;
            cursor: pointer;
        }
        .native-tab-bar-item.active{
            color: #4a56f8;
        }
        .native-tab-bar-label{
            font-size: 12px;
            padding-top: 4px;
            white-space: nowrap;
        }
        .native-tab-bar-icon{
            font-size: 22px;
        }
            */

        /* ------  menu sheet (full menu)  ------- */

        /*
        .native-tab-bar-menu-sheet-overlay{
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(8,8,19,0.64);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .native-tab-bar-menu-sheet.active .native-tab-bar-menu-sheet-overlay{
            opacity: 1;
            visibility: visible;
        }

        .native-tab-bar-menu-sheet.active .native-tab-bar-menu-sheet-inner{
            bottom: 0px;
        }

        .native-tab-bar-menu-sheet-inner .quick-action-wrap{
            padding-left: 10px;
            padding-right:10px;
        }

        .native-tab-bar-menu-sheet-inner{
            position: fixed;
            bottom: -100%;
            max-height: 90%;
            left: 0px;
            right: 0px;
            z-index: 1001;
            background-color: rgba(249, 251, 251, 1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: bottom 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding-bottom: 10px;
            padding-top: 10px;
        }
            */

    </style>

</html>